<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Neural Stochastic Differential Equations With Method of Moments · DiffEqFlux.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://diffeqflux.sciml.ai/stable/examples/neural_sde/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DiffEqFlux.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DiffEqFlux.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">DiffEqFlux.jl: High Level Scientific Machine Learning (SciML) Pre-Built Architectures</a></li><li><span class="tocitem">Differential Equation Machine Learning Tutorials</span><ul><li><a class="tocitem" href="../neural_ode/">Neural Ordinary Differential Equations</a></li><li><a class="tocitem" href="../GPUs/">Neural ODEs on GPUs</a></li><li><a class="tocitem" href="../mnist_neural_ode/">GPU-based MNIST Neural ODE Classifier</a></li><li><a class="tocitem" href="../mnist_conv_neural_ode/">Convolutional Neural ODE MNIST Classifier on GPU</a></li><li><a class="tocitem" href="../augmented_neural_ode/">Augmented Neural Ordinary Differential Equations</a></li><li class="is-active"><a class="tocitem" href>Neural Stochastic Differential Equations With Method of Moments</a></li><li><a class="tocitem" href="../collocation/">Smoothed Collocation for Fast Two-Stage Training</a></li><li><a class="tocitem" href="../normalizing_flows/">Continuous Normalizing Flows</a></li><li><a class="tocitem" href="../hamiltonian_nn/">Hamiltonian Neural Network</a></li><li><a class="tocitem" href="../tensor_layer/">Physics-Informed Machine Learning (PIML) with TensorLayer</a></li><li><a class="tocitem" href="../multiple_shooting/">Multiple Shooting</a></li></ul></li><li><span class="tocitem">Layer APIs</span><ul><li><a class="tocitem" href="../../layers/BasisLayers/">Classical Basis Layers</a></li><li><a class="tocitem" href="../../layers/TensorLayer/">Tensor Product Layer</a></li><li><a class="tocitem" href="../../layers/CNFLayer/">Continuous Normalizing Flows Layer</a></li><li><a class="tocitem" href="../../layers/SplineLayer/">Spline Layer</a></li><li><a class="tocitem" href="../../layers/NeuralDELayers/">Neural Differential Equation Layers</a></li><li><a class="tocitem" href="../../layers/HamiltonianNN/">Hamiltonian Neural Network Layer</a></li></ul></li><li><span class="tocitem">Utility Function APIs</span><ul><li><a class="tocitem" href="../../utilities/Collocation/">Smoothed Collocation</a></li><li><a class="tocitem" href="../../utilities/MultipleShooting/">Multiple Shooting Functionality</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Differential Equation Machine Learning Tutorials</a></li><li class="is-active"><a href>Neural Stochastic Differential Equations With Method of Moments</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Neural Stochastic Differential Equations With Method of Moments</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DiffEqFlux.jl/blob/master/docs/src/examples/neural_sde.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Neural-Stochastic-Differential-Equations-With-Method-of-Moments"><a class="docs-heading-anchor" href="#Neural-Stochastic-Differential-Equations-With-Method-of-Moments">Neural Stochastic Differential Equations With Method of Moments</a><a id="Neural-Stochastic-Differential-Equations-With-Method-of-Moments-1"></a><a class="docs-heading-anchor-permalink" href="#Neural-Stochastic-Differential-Equations-With-Method-of-Moments" title="Permalink"></a></h1><p>With neural stochastic differential equations, there is once again a helper form <code>neural_dmsde</code> which can be used for the multiplicative noise case (consult the layers API documentation, or <a href="https://github.com/MikeInnes/zygote-paper/blob/master/neural_sde/neural_sde.jl">this full example using the layer function</a>).</p><p>However, since there are far too many possible combinations for the API to support, in many cases you will want to performantly define neural differential equations for non-ODE systems from scratch. For these systems, it is generally best to use <code>TrackerAdjoint</code> with non-mutating (out-of-place) forms. For example, the following defines a neural SDE with neural networks for both the drift and diffusion terms:</p><pre><code class="language-julia hljs">dudt(u, p, t) = model(u)
g(u, p, t) = model2(u)
prob = SDEProblem(dudt, g, x, tspan, nothing)</code></pre><p>where <code>model</code> and <code>model2</code> are different neural networks. The same can apply to a neural delay differential equation. Its out-of-place formulation is <code>f(u,h,p,t)</code>. Thus for example, if we want to define a neural delay differential equation which uses the history value at <code>p.tau</code> in the past, we can define:</p><pre><code class="language-julia hljs">dudt!(u, h, p, t) = model([u; h(t - p.tau)])
prob = DDEProblem(dudt_, u0, h, tspan, nothing)</code></pre><p>First let&#39;s build training data from the same example as the neural ODE:</p><pre><code class="language-julia hljs">using Plots, Statistics
using Flux, Optimization, OptimizationFlux, DiffEqFlux, StochasticDiffEq, SciMLBase.EnsembleAnalysis

u0 = Float32[2.; 0.]
datasize = 30
tspan = (0.0f0, 1.0f0)
tsteps = range(tspan[1], tspan[2], length = datasize)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.0f0:0.03448276f0:1.0f0</code></pre><pre><code class="language-julia hljs">function trueSDEfunc(du, u, p, t)
    true_A = [-0.1 2.0; -2.0 -0.1]
    du .= ((u.^3)&#39;true_A)&#39;
end

mp = Float32[0.2, 0.2]
function true_noise_func(du, u, p, t)
    du .= mp.*u
end

prob_truesde = SDEProblem(trueSDEfunc, true_noise_func, u0, tspan)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDEProblem with uType Vector{Float32} and tType Float32. In-place: true
timespan: (0.0f0, 1.0f0)
u0: 2-element Vector{Float32}:
 2.0
 0.0</code></pre><p>For our dataset we will use DifferentialEquations.jl&#39;s <a href="http://docs.juliadiffeq.org/dev/features/ensemble.html">parallel ensemble interface</a> to generate data from the average of 10,000 runs of the SDE:</p><pre><code class="language-julia hljs"># Take a typical sample from the mean
ensemble_prob = EnsembleProblem(prob_truesde)
ensemble_sol = solve(ensemble_prob, SOSRI(), trajectories = 10000)
ensemble_sum = EnsembleSummary(ensemble_sol)

sde_data, sde_data_vars = Array.(timeseries_point_meanvar(ensemble_sol, tsteps))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Float32[2.0 1.9135298 … 0.056950483 0.13349777; 0.0 0.52743554 … -0.6839768 -0.6382879], Float32[0.0 0.07640485 … 1.3178419 1.2920247; 0.0 0.056226272 … 0.99482006 1.0240959])</code></pre><p>Now we build a neural SDE. For simplicity we will use the <code>NeuralDSDE</code> neural SDE with diagonal noise layer function:</p><pre><code class="language-julia hljs">drift_dudt = Flux.Chain(x -&gt; x.^3,
                       Flux.Dense(2, 50, tanh),
                       Flux.Dense(50, 2))
p1, re1 = Flux.destructure(drift_dudt)

diffusion_dudt = Flux.Chain(Flux.Dense(2, 2))
p2, re2 = Flux.destructure(diffusion_dudt)

neuralsde = NeuralDSDE(drift_dudt, diffusion_dudt, tspan, SOSRI(),
                       saveat = tsteps, reltol = 1e-1, abstol = 1e-1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NeuralDSDE()</code></pre><p>Let&#39;s see what that looks like:</p><pre><code class="language-julia hljs"># Get the prediction using the correct initial condition
prediction0 = neuralsde(u0)

drift_(u, p, t) = re1(p[1:neuralsde.len])(u)
diffusion_(u, p, t) = re2(p[neuralsde.len+1:end])(u)

prob_neuralsde = SDEProblem(drift_, diffusion_, u0,(0.0f0, 1.2f0), neuralsde.p)

ensemble_nprob = EnsembleProblem(prob_neuralsde)
ensemble_nsol = solve(ensemble_nprob, SOSRI(), trajectories = 100,
                      saveat = tsteps)
ensemble_nsum = EnsembleSummary(ensemble_nsol)

plt1 = plot(ensemble_nsum, title = &quot;Neural SDE: Before Training&quot;)
scatter!(plt1, tsteps, sde_data&#39;, lw = 3)

scatter(tsteps, sde_data[1,:], label = &quot;data&quot;)
scatter!(tsteps, prediction0[1,:], label = &quot;prediction&quot;)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip340">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip340)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip341">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip340)" d="
M112.177 1486.45 L2352.76 1486.45 L2352.76 47.2441 L112.177 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip342">
    <rect x="112" y="47" width="2242" height="1440"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  175.59,1486.45 175.59,47.2441 
  "/>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  704.028,1486.45 704.028,47.2441 
  "/>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1232.47,1486.45 1232.47,47.2441 
  "/>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1760.9,1486.45 1760.9,47.2441 
  "/>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2289.34,1486.45 2289.34,47.2441 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  112.177,1486.45 2352.76,1486.45 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  175.59,1486.45 175.59,1467.55 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  704.028,1486.45 704.028,1467.55 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1232.47,1486.45 1232.47,1467.55 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1760.9,1486.45 1760.9,1467.55 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2289.34,1486.45 2289.34,1467.55 
  "/>
<path clip-path="url(#clip340)" d="M137.893 1517.37 Q134.282 1517.37 132.453 1520.93 Q130.648 1524.47 130.648 1531.6 Q130.648 1538.71 132.453 1542.27 Q134.282 1545.82 137.893 1545.82 Q141.527 1545.82 143.333 1542.27 Q145.162 1538.71 145.162 1531.6 Q145.162 1524.47 143.333 1520.93 Q141.527 1517.37 137.893 1517.37 M137.893 1513.66 Q143.703 1513.66 146.759 1518.27 Q149.838 1522.85 149.838 1531.6 Q149.838 1540.33 146.759 1544.94 Q143.703 1549.52 137.893 1549.52 Q132.083 1549.52 129.004 1544.94 Q125.949 1540.33 125.949 1531.6 Q125.949 1522.85 129.004 1518.27 Q132.083 1513.66 137.893 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M158.055 1542.97 L162.939 1542.97 L162.939 1548.85 L158.055 1548.85 L158.055 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M183.124 1517.37 Q179.513 1517.37 177.685 1520.93 Q175.879 1524.47 175.879 1531.6 Q175.879 1538.71 177.685 1542.27 Q179.513 1545.82 183.124 1545.82 Q186.759 1545.82 188.564 1542.27 Q190.393 1538.71 190.393 1531.6 Q190.393 1524.47 188.564 1520.93 Q186.759 1517.37 183.124 1517.37 M183.124 1513.66 Q188.935 1513.66 191.99 1518.27 Q195.069 1522.85 195.069 1531.6 Q195.069 1540.33 191.99 1544.94 Q188.935 1549.52 183.124 1549.52 Q177.314 1549.52 174.236 1544.94 Q171.18 1540.33 171.18 1531.6 Q171.18 1522.85 174.236 1518.27 Q177.314 1513.66 183.124 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M213.286 1517.37 Q209.675 1517.37 207.847 1520.93 Q206.041 1524.47 206.041 1531.6 Q206.041 1538.71 207.847 1542.27 Q209.675 1545.82 213.286 1545.82 Q216.921 1545.82 218.726 1542.27 Q220.555 1538.71 220.555 1531.6 Q220.555 1524.47 218.726 1520.93 Q216.921 1517.37 213.286 1517.37 M213.286 1513.66 Q219.096 1513.66 222.152 1518.27 Q225.231 1522.85 225.231 1531.6 Q225.231 1540.33 222.152 1544.94 Q219.096 1549.52 213.286 1549.52 Q207.476 1549.52 204.397 1544.94 Q201.342 1540.33 201.342 1531.6 Q201.342 1522.85 204.397 1518.27 Q207.476 1513.66 213.286 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M666.829 1517.37 Q663.218 1517.37 661.39 1520.93 Q659.584 1524.47 659.584 1531.6 Q659.584 1538.71 661.39 1542.27 Q663.218 1545.82 666.829 1545.82 Q670.464 1545.82 672.269 1542.27 Q674.098 1538.71 674.098 1531.6 Q674.098 1524.47 672.269 1520.93 Q670.464 1517.37 666.829 1517.37 M666.829 1513.66 Q672.639 1513.66 675.695 1518.27 Q678.774 1522.85 678.774 1531.6 Q678.774 1540.33 675.695 1544.94 Q672.639 1549.52 666.829 1549.52 Q661.019 1549.52 657.94 1544.94 Q654.885 1540.33 654.885 1531.6 Q654.885 1522.85 657.94 1518.27 Q661.019 1513.66 666.829 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M686.991 1542.97 L691.875 1542.97 L691.875 1548.85 L686.991 1548.85 L686.991 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M706.088 1544.91 L722.408 1544.91 L722.408 1548.85 L700.463 1548.85 L700.463 1544.91 Q703.125 1542.16 707.709 1537.53 Q712.315 1532.88 713.496 1531.53 Q715.741 1529.01 716.621 1527.27 Q717.523 1525.51 717.523 1523.82 Q717.523 1521.07 715.579 1519.33 Q713.658 1517.6 710.556 1517.6 Q708.357 1517.6 705.903 1518.36 Q703.473 1519.13 700.695 1520.68 L700.695 1515.95 Q703.519 1514.82 705.973 1514.24 Q708.426 1513.66 710.463 1513.66 Q715.834 1513.66 719.028 1516.35 Q722.223 1519.03 722.223 1523.52 Q722.223 1525.65 721.412 1527.57 Q720.625 1529.47 718.519 1532.07 Q717.94 1532.74 714.838 1535.95 Q711.736 1539.15 706.088 1544.91 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M732.269 1514.29 L750.625 1514.29 L750.625 1518.22 L736.551 1518.22 L736.551 1526.7 Q737.57 1526.35 738.588 1526.19 Q739.607 1526 740.625 1526 Q746.412 1526 749.792 1529.17 Q753.171 1532.34 753.171 1537.76 Q753.171 1543.34 749.699 1546.44 Q746.227 1549.52 739.908 1549.52 Q737.732 1549.52 735.463 1549.15 Q733.218 1548.78 730.81 1548.04 L730.81 1543.34 Q732.894 1544.47 735.116 1545.03 Q737.338 1545.58 739.815 1545.58 Q743.82 1545.58 746.158 1543.48 Q748.496 1541.37 748.496 1537.76 Q748.496 1534.15 746.158 1532.04 Q743.82 1529.94 739.815 1529.94 Q737.94 1529.94 736.065 1530.35 Q734.213 1530.77 732.269 1531.65 L732.269 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M1194.77 1517.37 Q1191.16 1517.37 1189.33 1520.93 Q1187.52 1524.47 1187.52 1531.6 Q1187.52 1538.71 1189.33 1542.27 Q1191.16 1545.82 1194.77 1545.82 Q1198.4 1545.82 1200.21 1542.27 Q1202.04 1538.71 1202.04 1531.6 Q1202.04 1524.47 1200.21 1520.93 Q1198.4 1517.37 1194.77 1517.37 M1194.77 1513.66 Q1200.58 1513.66 1203.64 1518.27 Q1206.71 1522.85 1206.71 1531.6 Q1206.71 1540.33 1203.64 1544.94 Q1200.58 1549.52 1194.77 1549.52 Q1188.96 1549.52 1185.88 1544.94 Q1182.83 1540.33 1182.83 1531.6 Q1182.83 1522.85 1185.88 1518.27 Q1188.96 1513.66 1194.77 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M1214.93 1542.97 L1219.82 1542.97 L1219.82 1548.85 L1214.93 1548.85 L1214.93 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M1230.05 1514.29 L1248.4 1514.29 L1248.4 1518.22 L1234.33 1518.22 L1234.33 1526.7 Q1235.35 1526.35 1236.37 1526.19 Q1237.39 1526 1238.4 1526 Q1244.19 1526 1247.57 1529.17 Q1250.95 1532.34 1250.95 1537.76 Q1250.95 1543.34 1247.48 1546.44 Q1244.01 1549.52 1237.69 1549.52 Q1235.51 1549.52 1233.24 1549.15 Q1231 1548.78 1228.59 1548.04 L1228.59 1543.34 Q1230.67 1544.47 1232.89 1545.03 Q1235.12 1545.58 1237.59 1545.58 Q1241.6 1545.58 1243.94 1543.48 Q1246.27 1541.37 1246.27 1537.76 Q1246.27 1534.15 1243.94 1532.04 Q1241.6 1529.94 1237.59 1529.94 Q1235.72 1529.94 1233.84 1530.35 Q1231.99 1530.77 1230.05 1531.65 L1230.05 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M1270.16 1517.37 Q1266.55 1517.37 1264.72 1520.93 Q1262.92 1524.47 1262.92 1531.6 Q1262.92 1538.71 1264.72 1542.27 Q1266.55 1545.82 1270.16 1545.82 Q1273.8 1545.82 1275.6 1542.27 Q1277.43 1538.71 1277.43 1531.6 Q1277.43 1524.47 1275.6 1520.93 Q1273.8 1517.37 1270.16 1517.37 M1270.16 1513.66 Q1275.97 1513.66 1279.03 1518.27 Q1282.11 1522.85 1282.11 1531.6 Q1282.11 1540.33 1279.03 1544.94 Q1275.97 1549.52 1270.16 1549.52 Q1264.35 1549.52 1261.27 1544.94 Q1258.22 1540.33 1258.22 1531.6 Q1258.22 1522.85 1261.27 1518.27 Q1264.35 1513.66 1270.16 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M1723.71 1517.37 Q1720.09 1517.37 1718.27 1520.93 Q1716.46 1524.47 1716.46 1531.6 Q1716.46 1538.71 1718.27 1542.27 Q1720.09 1545.82 1723.71 1545.82 Q1727.34 1545.82 1729.15 1542.27 Q1730.97 1538.71 1730.97 1531.6 Q1730.97 1524.47 1729.15 1520.93 Q1727.34 1517.37 1723.71 1517.37 M1723.71 1513.66 Q1729.52 1513.66 1732.57 1518.27 Q1735.65 1522.85 1735.65 1531.6 Q1735.65 1540.33 1732.57 1544.94 Q1729.52 1549.52 1723.71 1549.52 Q1717.9 1549.52 1714.82 1544.94 Q1711.76 1540.33 1711.76 1531.6 Q1711.76 1522.85 1714.82 1518.27 Q1717.9 1513.66 1723.71 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M1743.87 1542.97 L1748.75 1542.97 L1748.75 1548.85 L1743.87 1548.85 L1743.87 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M1757.76 1514.29 L1779.98 1514.29 L1779.98 1516.28 L1767.43 1548.85 L1762.55 1548.85 L1774.35 1518.22 L1757.76 1518.22 L1757.76 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M1789.15 1514.29 L1807.5 1514.29 L1807.5 1518.22 L1793.43 1518.22 L1793.43 1526.7 Q1794.45 1526.35 1795.46 1526.19 Q1796.48 1526 1797.5 1526 Q1803.29 1526 1806.67 1529.17 Q1810.05 1532.34 1810.05 1537.76 Q1810.05 1543.34 1806.58 1546.44 Q1803.1 1549.52 1796.78 1549.52 Q1794.61 1549.52 1792.34 1549.15 Q1790.09 1548.78 1787.69 1548.04 L1787.69 1543.34 Q1789.77 1544.47 1791.99 1545.03 Q1794.21 1545.58 1796.69 1545.58 Q1800.7 1545.58 1803.03 1543.48 Q1805.37 1541.37 1805.37 1537.76 Q1805.37 1534.15 1803.03 1532.04 Q1800.7 1529.94 1796.69 1529.94 Q1794.82 1529.94 1792.94 1530.35 Q1791.09 1530.77 1789.15 1531.65 L1789.15 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2241.42 1544.91 L2249.05 1544.91 L2249.05 1518.55 L2240.74 1520.21 L2240.74 1515.95 L2249.01 1514.29 L2253.68 1514.29 L2253.68 1544.91 L2261.32 1544.91 L2261.32 1548.85 L2241.42 1548.85 L2241.42 1544.91 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2270.77 1542.97 L2275.65 1542.97 L2275.65 1548.85 L2270.77 1548.85 L2270.77 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2295.84 1517.37 Q2292.23 1517.37 2290.4 1520.93 Q2288.59 1524.47 2288.59 1531.6 Q2288.59 1538.71 2290.4 1542.27 Q2292.23 1545.82 2295.84 1545.82 Q2299.47 1545.82 2301.28 1542.27 Q2303.1 1538.71 2303.1 1531.6 Q2303.1 1524.47 2301.28 1520.93 Q2299.47 1517.37 2295.84 1517.37 M2295.84 1513.66 Q2301.65 1513.66 2304.7 1518.27 Q2307.78 1522.85 2307.78 1531.6 Q2307.78 1540.33 2304.7 1544.94 Q2301.65 1549.52 2295.84 1549.52 Q2290.03 1549.52 2286.95 1544.94 Q2283.89 1540.33 2283.89 1531.6 Q2283.89 1522.85 2286.95 1518.27 Q2290.03 1513.66 2295.84 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2326 1517.37 Q2322.39 1517.37 2320.56 1520.93 Q2318.75 1524.47 2318.75 1531.6 Q2318.75 1538.71 2320.56 1542.27 Q2322.39 1545.82 2326 1545.82 Q2329.63 1545.82 2331.44 1542.27 Q2333.27 1538.71 2333.27 1531.6 Q2333.27 1524.47 2331.44 1520.93 Q2329.63 1517.37 2326 1517.37 M2326 1513.66 Q2331.81 1513.66 2334.86 1518.27 Q2337.94 1522.85 2337.94 1531.6 Q2337.94 1540.33 2334.86 1544.94 Q2331.81 1549.52 2326 1549.52 Q2320.19 1549.52 2317.11 1544.94 Q2314.05 1540.33 2314.05 1531.6 Q2314.05 1522.85 2317.11 1518.27 Q2320.19 1513.66 2326 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  112.177,1235.8 2352.76,1235.8 
  "/>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  112.177,905.674 2352.76,905.674 
  "/>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  112.177,575.544 2352.76,575.544 
  "/>
<polyline clip-path="url(#clip342)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  112.177,245.414 2352.76,245.414 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  112.177,1486.45 112.177,47.2441 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  112.177,1235.8 131.075,1235.8 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  112.177,905.674 131.075,905.674 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  112.177,575.544 131.075,575.544 
  "/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  112.177,245.414 131.075,245.414 
  "/>
<path clip-path="url(#clip340)" d="M64.2328 1221.6 Q60.6217 1221.6 58.793 1225.17 Q56.9875 1228.71 56.9875 1235.84 Q56.9875 1242.95 58.793 1246.51 Q60.6217 1250.05 64.2328 1250.05 Q67.867 1250.05 69.6726 1246.51 Q71.5013 1242.95 71.5013 1235.84 Q71.5013 1228.71 69.6726 1225.17 Q67.867 1221.6 64.2328 1221.6 M64.2328 1217.9 Q70.0429 1217.9 73.0985 1222.51 Q76.1772 1227.09 76.1772 1235.84 Q76.1772 1244.57 73.0985 1249.17 Q70.0429 1253.76 64.2328 1253.76 Q58.4226 1253.76 55.344 1249.17 Q52.2884 1244.57 52.2884 1235.84 Q52.2884 1227.09 55.344 1222.51 Q58.4226 1217.9 64.2328 1217.9 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M59.8578 919.019 L76.1772 919.019 L76.1772 922.954 L54.2328 922.954 L54.2328 919.019 Q56.8949 916.264 61.4782 911.635 Q66.0846 906.982 67.2652 905.639 Q69.5105 903.116 70.3902 901.38 Q71.2929 899.621 71.2929 897.931 Q71.2929 895.177 69.3485 893.44 Q67.4272 891.704 64.3254 891.704 Q62.1263 891.704 59.6726 892.468 Q57.2421 893.232 54.4643 894.783 L54.4643 890.061 Q57.2884 888.927 59.7421 888.348 Q62.1958 887.769 64.2328 887.769 Q69.6031 887.769 72.7976 890.454 Q75.992 893.14 75.992 897.63 Q75.992 899.76 75.1818 901.681 Q74.3948 903.579 72.2883 906.172 Q71.7096 906.843 68.6078 910.061 Q65.5059 913.255 59.8578 919.019 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M66.5939 562.338 L54.7884 580.787 L66.5939 580.787 L66.5939 562.338 M65.367 558.264 L71.2466 558.264 L71.2466 580.787 L76.1772 580.787 L76.1772 584.676 L71.2466 584.676 L71.2466 592.824 L66.5939 592.824 L66.5939 584.676 L50.9921 584.676 L50.9921 580.162 L65.367 558.264 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M64.6495 243.551 Q61.5013 243.551 59.6495 245.704 Q57.8208 247.857 57.8208 251.607 Q57.8208 255.333 59.6495 257.509 Q61.5013 259.662 64.6495 259.662 Q67.7976 259.662 69.6263 257.509 Q71.4781 255.333 71.4781 251.607 Q71.4781 247.857 69.6263 245.704 Q67.7976 243.551 64.6495 243.551 M73.9318 228.898 L73.9318 233.158 Q72.1726 232.324 70.367 231.884 Q68.5846 231.445 66.8254 231.445 Q62.1958 231.445 59.7421 234.57 Q57.3115 237.695 56.9643 244.014 Q58.33 242 60.3902 240.935 Q62.4504 239.847 64.9272 239.847 Q70.1355 239.847 73.1448 243.019 Q76.1772 246.167 76.1772 251.607 Q76.1772 256.931 73.029 260.148 Q69.8809 263.366 64.6495 263.366 Q58.6541 263.366 55.4828 258.782 Q52.3116 254.176 52.3116 245.449 Q52.3116 237.255 56.2004 232.394 Q60.0893 227.509 66.6402 227.509 Q68.3994 227.509 70.1818 227.857 Q71.9874 228.204 73.9318 228.898 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><circle clip-path="url(#clip342)" cx="175.59" cy="905.674" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="248.478" cy="919.947" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="321.366" cy="933.506" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="394.254" cy="966.415" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="467.142" cy="1018.87" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="540.03" cy="1082.54" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="612.918" cy="1149.95" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="685.806" cy="1215.68" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="758.694" cy="1275.59" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="831.582" cy="1327.18" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="904.47" cy="1369.43" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="977.358" cy="1401.85" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1050.25" cy="1424.85" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1123.13" cy="1439.18" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1196.02" cy="1445.72" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1268.91" cy="1445.38" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1341.8" cy="1439.35" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1414.69" cy="1428.78" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1487.57" cy="1414.45" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1560.46" cy="1397.27" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1633.35" cy="1377.93" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1706.24" cy="1357.1" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1779.13" cy="1335.96" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1852.02" cy="1314.97" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1924.9" cy="1294.68" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1997.79" cy="1275.38" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="2070.68" cy="1257.4" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="2143.57" cy="1241.05" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="2216.46" cy="1226.4" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="2289.34" cy="1213.77" r="14" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="175.59" cy="905.674" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="248.478" cy="912.833" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="321.366" cy="951.101" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="394.254" cy="946.854" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="467.142" cy="922.828" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="540.03" cy="924.23" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="612.918" cy="889.931" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="685.806" cy="926.761" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="758.694" cy="896.04" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="831.582" cy="881.267" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="904.47" cy="910.661" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="977.358" cy="962.56" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1050.25" cy="958.087" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1123.13" cy="930.765" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1196.02" cy="854.03" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1268.91" cy="865.265" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1341.8" cy="835.05" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1414.69" cy="867.08" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1487.57" cy="940.922" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1560.46" cy="954.071" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1633.35" cy="946.464" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1706.24" cy="845.669" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1779.13" cy="685.072" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1852.02" cy="494.508" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1924.9" cy="431.563" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="1997.79" cy="552.518" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="2070.68" cy="418.034" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="2143.57" cy="350.893" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="2216.46" cy="381.567" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip342)" cx="2289.34" cy="87.9763" r="14" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<path clip-path="url(#clip340)" d="
M1799.6 250.738 L2278.07 250.738 L2278.07 95.2176 L1799.6 95.2176  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip340)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1799.6,250.738 2278.07,250.738 2278.07,95.2176 1799.6,95.2176 1799.6,250.738 
  "/>
<circle clip-path="url(#clip340)" cx="1899.19" cy="147.058" r="23" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="5.12"/>
<path clip-path="url(#clip340)" d="M2017.68 142.347 L2017.68 128.319 L2021.94 128.319 L2021.94 164.338 L2017.68 164.338 L2017.68 160.449 Q2016.34 162.763 2014.28 163.898 Q2012.24 165.009 2009.37 165.009 Q2004.67 165.009 2001.71 161.259 Q1998.77 157.509 1998.77 151.398 Q1998.77 145.287 2001.71 141.537 Q2004.67 137.787 2009.37 137.787 Q2012.24 137.787 2014.28 138.921 Q2016.34 140.032 2017.68 142.347 M2003.16 151.398 Q2003.16 156.097 2005.09 158.782 Q2007.03 161.444 2010.41 161.444 Q2013.79 161.444 2015.73 158.782 Q2017.68 156.097 2017.68 151.398 Q2017.68 146.699 2015.73 144.037 Q2013.79 141.352 2010.41 141.352 Q2007.03 141.352 2005.09 144.037 Q2003.16 146.699 2003.16 151.398 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2042.49 151.305 Q2037.33 151.305 2035.34 152.486 Q2033.35 153.666 2033.35 156.514 Q2033.35 158.782 2034.83 160.125 Q2036.34 161.444 2038.91 161.444 Q2042.45 161.444 2044.58 158.944 Q2046.73 156.421 2046.73 152.254 L2046.73 151.305 L2042.49 151.305 M2050.99 149.546 L2050.99 164.338 L2046.73 164.338 L2046.73 160.402 Q2045.27 162.763 2043.1 163.898 Q2040.92 165.009 2037.77 165.009 Q2033.79 165.009 2031.43 162.787 Q2029.09 160.541 2029.09 156.791 Q2029.09 152.416 2032.01 150.194 Q2034.95 147.972 2040.76 147.972 L2046.73 147.972 L2046.73 147.555 Q2046.73 144.615 2044.78 143.018 Q2042.86 141.398 2039.37 141.398 Q2037.15 141.398 2035.04 141.93 Q2032.93 142.463 2030.99 143.527 L2030.99 139.592 Q2033.33 138.69 2035.53 138.25 Q2037.72 137.787 2039.81 137.787 Q2045.43 137.787 2048.21 140.703 Q2050.99 143.62 2050.99 149.546 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2063.97 131.051 L2063.97 138.412 L2072.75 138.412 L2072.75 141.722 L2063.97 141.722 L2063.97 155.796 Q2063.97 158.967 2064.83 159.87 Q2065.71 160.773 2068.37 160.773 L2072.75 160.773 L2072.75 164.338 L2068.37 164.338 Q2063.44 164.338 2061.57 162.509 Q2059.69 160.657 2059.69 155.796 L2059.69 141.722 L2056.57 141.722 L2056.57 138.412 L2059.69 138.412 L2059.69 131.051 L2063.97 131.051 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2090.13 151.305 Q2084.97 151.305 2082.98 152.486 Q2080.99 153.666 2080.99 156.514 Q2080.99 158.782 2082.47 160.125 Q2083.97 161.444 2086.54 161.444 Q2090.09 161.444 2092.22 158.944 Q2094.37 156.421 2094.37 152.254 L2094.37 151.305 L2090.13 151.305 M2098.63 149.546 L2098.63 164.338 L2094.37 164.338 L2094.37 160.402 Q2092.91 162.763 2090.73 163.898 Q2088.56 165.009 2085.41 165.009 Q2081.43 165.009 2079.07 162.787 Q2076.73 160.541 2076.73 156.791 Q2076.73 152.416 2079.65 150.194 Q2082.59 147.972 2088.4 147.972 L2094.37 147.972 L2094.37 147.555 Q2094.37 144.615 2092.42 143.018 Q2090.5 141.398 2087.01 141.398 Q2084.78 141.398 2082.68 141.93 Q2080.57 142.463 2078.63 143.527 L2078.63 139.592 Q2080.97 138.69 2083.16 138.25 Q2085.36 137.787 2087.45 137.787 Q2093.07 137.787 2095.85 140.703 Q2098.63 143.62 2098.63 149.546 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><circle clip-path="url(#clip340)" cx="1899.19" cy="198.898" r="23" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="5.12"/>
<path clip-path="url(#clip340)" d="M2003.05 212.289 L2003.05 226.039 L1998.77 226.039 L1998.77 190.252 L2003.05 190.252 L2003.05 194.187 Q2004.39 191.872 2006.43 190.761 Q2008.49 189.627 2011.34 189.627 Q2016.06 189.627 2019 193.377 Q2021.96 197.127 2021.96 203.238 Q2021.96 209.349 2019 213.099 Q2016.06 216.849 2011.34 216.849 Q2008.49 216.849 2006.43 215.738 Q2004.39 214.603 2003.05 212.289 M2017.54 203.238 Q2017.54 198.539 2015.6 195.877 Q2013.67 193.192 2010.29 193.192 Q2006.91 193.192 2004.97 195.877 Q2003.05 198.539 2003.05 203.238 Q2003.05 207.937 2004.97 210.622 Q2006.91 213.284 2010.29 213.284 Q2013.67 213.284 2015.6 210.622 Q2017.54 207.937 2017.54 203.238 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2044.04 194.233 Q2043.33 193.817 2042.47 193.631 Q2041.64 193.423 2040.62 193.423 Q2037.01 193.423 2035.06 195.784 Q2033.14 198.122 2033.14 202.52 L2033.14 216.178 L2028.86 216.178 L2028.86 190.252 L2033.14 190.252 L2033.14 194.28 Q2034.48 191.918 2036.64 190.784 Q2038.79 189.627 2041.87 189.627 Q2042.31 189.627 2042.84 189.696 Q2043.37 189.743 2044.02 189.858 L2044.04 194.233 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2069.65 202.15 L2069.65 204.233 L2050.06 204.233 Q2050.34 208.631 2052.7 210.946 Q2055.09 213.238 2059.32 213.238 Q2061.78 213.238 2064.07 212.636 Q2066.38 212.034 2068.65 210.83 L2068.65 214.858 Q2066.36 215.83 2063.95 216.34 Q2061.54 216.849 2059.07 216.849 Q2052.86 216.849 2049.23 213.238 Q2045.62 209.627 2045.62 203.469 Q2045.62 197.104 2049.04 193.377 Q2052.49 189.627 2058.33 189.627 Q2063.56 189.627 2066.59 193.006 Q2069.65 196.363 2069.65 202.15 M2065.39 200.9 Q2065.34 197.405 2063.42 195.321 Q2061.52 193.238 2058.37 193.238 Q2054.81 193.238 2052.66 195.252 Q2050.53 197.266 2050.2 200.923 L2065.39 200.9 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2093.7 194.187 L2093.7 180.159 L2097.96 180.159 L2097.96 216.178 L2093.7 216.178 L2093.7 212.289 Q2092.35 214.603 2090.29 215.738 Q2088.26 216.849 2085.39 216.849 Q2080.69 216.849 2077.72 213.099 Q2074.78 209.349 2074.78 203.238 Q2074.78 197.127 2077.72 193.377 Q2080.69 189.627 2085.39 189.627 Q2088.26 189.627 2090.29 190.761 Q2092.35 191.872 2093.7 194.187 M2079.18 203.238 Q2079.18 207.937 2081.1 210.622 Q2083.05 213.284 2086.43 213.284 Q2089.81 213.284 2091.75 210.622 Q2093.7 207.937 2093.7 203.238 Q2093.7 198.539 2091.75 195.877 Q2089.81 193.192 2086.43 193.192 Q2083.05 193.192 2081.1 195.877 Q2079.18 198.539 2079.18 203.238 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2106.73 190.252 L2110.99 190.252 L2110.99 216.178 L2106.73 216.178 L2106.73 190.252 M2106.73 180.159 L2110.99 180.159 L2110.99 185.553 L2106.73 185.553 L2106.73 180.159 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2138.56 191.247 L2138.56 195.229 Q2136.75 194.233 2134.92 193.747 Q2133.12 193.238 2131.27 193.238 Q2127.12 193.238 2124.83 195.877 Q2122.54 198.492 2122.54 203.238 Q2122.54 207.983 2124.83 210.622 Q2127.12 213.238 2131.27 213.238 Q2133.12 213.238 2134.92 212.752 Q2136.75 212.242 2138.56 211.247 L2138.56 215.182 Q2136.78 216.016 2134.85 216.432 Q2132.96 216.849 2130.8 216.849 Q2124.95 216.849 2121.5 213.168 Q2118.05 209.488 2118.05 203.238 Q2118.05 196.895 2121.52 193.261 Q2125.02 189.627 2131.08 189.627 Q2133.05 189.627 2134.92 190.043 Q2136.8 190.437 2138.56 191.247 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2150.18 182.891 L2150.18 190.252 L2158.95 190.252 L2158.95 193.562 L2150.18 193.562 L2150.18 207.636 Q2150.18 210.807 2151.03 211.71 Q2151.91 212.613 2154.58 212.613 L2158.95 212.613 L2158.95 216.178 L2154.58 216.178 Q2149.65 216.178 2147.77 214.349 Q2145.9 212.497 2145.9 207.636 L2145.9 193.562 L2142.77 193.562 L2142.77 190.252 L2145.9 190.252 L2145.9 182.891 L2150.18 182.891 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2164.55 190.252 L2168.81 190.252 L2168.81 216.178 L2164.55 216.178 L2164.55 190.252 M2164.55 180.159 L2168.81 180.159 L2168.81 185.553 L2164.55 185.553 L2164.55 180.159 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2187.77 193.238 Q2184.34 193.238 2182.35 195.923 Q2180.36 198.585 2180.36 203.238 Q2180.36 207.891 2182.33 210.576 Q2184.32 213.238 2187.77 213.238 Q2191.17 213.238 2193.16 210.553 Q2195.15 207.867 2195.15 203.238 Q2195.15 198.631 2193.16 195.946 Q2191.17 193.238 2187.77 193.238 M2187.77 189.627 Q2193.33 189.627 2196.5 193.238 Q2199.67 196.849 2199.67 203.238 Q2199.67 209.604 2196.5 213.238 Q2193.33 216.849 2187.77 216.849 Q2182.19 216.849 2179.02 213.238 Q2175.87 209.604 2175.87 203.238 Q2175.87 196.849 2179.02 193.238 Q2182.19 189.627 2187.77 189.627 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip340)" d="M2228.28 200.529 L2228.28 216.178 L2224.02 216.178 L2224.02 200.668 Q2224.02 196.988 2222.58 195.159 Q2221.15 193.33 2218.28 193.33 Q2214.83 193.33 2212.84 195.53 Q2210.85 197.729 2210.85 201.525 L2210.85 216.178 L2206.57 216.178 L2206.57 190.252 L2210.85 190.252 L2210.85 194.28 Q2212.38 191.942 2214.44 190.784 Q2216.52 189.627 2219.23 189.627 Q2223.7 189.627 2225.99 192.405 Q2228.28 195.159 2228.28 200.529 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>Now just as with the neural ODE we define a loss function that calculates the mean and variance from <code>n</code> runs at each time point and uses the distance from the data values:</p><pre><code class="language-julia hljs">function predict_neuralsde(p, u = u0)
  return Array(neuralsde(u, p))
end

function loss_neuralsde(p; n = 100)
  u = repeat(reshape(u0, :, 1), 1, n)
  samples = predict_neuralsde(p, u)
  means = mean(samples, dims = 2)
  vars = var(samples, dims = 2, mean = means)[:, 1, :]
  means = means[:, 1, :]
  loss = sum(abs2, sde_data - means) + sum(abs2, sde_data_vars - vars)
  return loss, means, vars
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">loss_neuralsde (generic function with 1 method)</code></pre><pre><code class="language-julia hljs">list_plots = []
iter = 0

# Callback function to observe training
callback = function (p, loss, means, vars; doplot = false)
  global list_plots, iter

  if iter == 0
    list_plots = []
  end
  iter += 1

  # loss against current data
  display(loss)

  # plot current prediction against data
  plt = Plots.scatter(tsteps, sde_data[1,:], yerror = sde_data_vars[1,:],
                     ylim = (-4.0, 8.0), label = &quot;data&quot;)
  Plots.scatter!(plt, tsteps, means[1,:], ribbon = vars[1,:], label = &quot;prediction&quot;)
  push!(list_plots, plt)

  if doplot
    display(plt)
  end
  return false
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">#4 (generic function with 1 method)</code></pre><p>Now we train using this loss function. We can pre-train a little bit using a smaller <code>n</code> and then decrease it after it has had some time to adjust towards the right mean behavior:</p><pre><code class="language-julia hljs">opt = ADAM(0.025)

# First round of training with n = 10
adtype = Optimization.AutoZygote()
optf = Optimization.OptimizationFunction((x,p) -&gt; loss_neuralsde(x, n=10), adtype)
optprob = Optimization.OptimizationProblem(optf, neuralsde.p)
result1 = Optimization.solve(optprob, opt,
                                 callback = callback, maxiters = 100)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">u: 258-element Vector{Float32}:
  0.48625585
 -0.07821309
 -0.031109923
  0.070605874
  0.05992323
 -0.50555986
  0.14369448
  0.48924258
  0.24019447
 -0.52731276
  ⋮
  0.075910926
 -0.30849195
 -0.24855167
  0.18981808
  0.949057
  0.7359422
 -0.34989235
 -0.22461016
 -0.21185441</code></pre><p>We resume the training with a larger <code>n</code>. (WARNING - this step is a couple of orders of magnitude longer than the previous one).</p><pre><code class="language-julia hljs">optf2 = Optimization.OptimizationFunction((x,p) -&gt; loss_neuralsde(x, n=100), adtype)
optprob2 = Optimization.OptimizationProblem(optf2, result1.u)
result2 = Optimization.solve(optprob2, opt,
                                 callback = callback, maxiters = 100)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">u: 258-element Vector{Float32}:
  0.57810074
 -0.06402557
  0.14547174
  0.2685546
  0.03829462
 -0.37437642
  0.14473942
  0.69436526
  0.24083316
 -0.2951372
  ⋮
 -0.2868991
  0.0010573899
 -0.41485658
  0.13957962
  0.99687165
  1.0994043
 -0.123029776
 -0.38127306
 -0.5911887</code></pre><p>And now we plot the solution to an ensemble of the trained neural SDE:</p><pre><code class="language-julia hljs">_, means, vars = loss_neuralsde(result2.u, n = 1000)

plt2 = Plots.scatter(tsteps, sde_data&#39;, yerror = sde_data_vars&#39;,
                     label = &quot;data&quot;, title = &quot;Neural SDE: After Training&quot;,
                     xlabel = &quot;Time&quot;)
plot!(plt2, tsteps, means&#39;, lw = 8, ribbon = vars&#39;, label = &quot;prediction&quot;)

plt = plot(plt1, plt2, layout = (2, 1))
savefig(plt, &quot;NN_sde_combined.png&quot;); nothing # sde</code></pre><p><img src="https://user-images.githubusercontent.com/1814174/76975872-88dc9100-6909-11ea-80f7-242f661ebad1.png" alt/></p><p>Try this with GPUs as well!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../augmented_neural_ode/">« Augmented Neural Ordinary Differential Equations</a><a class="docs-footer-nextpage" href="../collocation/">Smoothed Collocation for Fast Two-Stage Training »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Friday 1 July 2022 00:04">Friday 1 July 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
