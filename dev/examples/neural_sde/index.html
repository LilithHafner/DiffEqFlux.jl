<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Neural Stochastic Differential Equations With Method of Moments · DiffEqFlux.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/DiffEqFlux/stable/examples/neural_sde/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DiffEqFlux.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DiffEqFlux.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">DiffEqFlux.jl: High Level Scientific Machine Learning (SciML) Pre-Built Architectures</a></li><li><span class="tocitem">Differential Equation Machine Learning Tutorials</span><ul><li><a class="tocitem" href="../neural_ode/">Neural Ordinary Differential Equations</a></li><li><a class="tocitem" href="../GPUs/">Neural ODEs on GPUs</a></li><li><a class="tocitem" href="../mnist_neural_ode/">GPU-based MNIST Neural ODE Classifier</a></li><li><a class="tocitem" href="../mnist_conv_neural_ode/">Convolutional Neural ODE MNIST Classifier on GPU</a></li><li><a class="tocitem" href="../augmented_neural_ode/">Augmented Neural Ordinary Differential Equations</a></li><li class="is-active"><a class="tocitem" href>Neural Stochastic Differential Equations With Method of Moments</a></li><li><a class="tocitem" href="../collocation/">Smoothed Collocation for Fast Two-Stage Training</a></li><li><a class="tocitem" href="../normalizing_flows/">Continuous Normalizing Flows</a></li><li><a class="tocitem" href="../hamiltonian_nn/">Hamiltonian Neural Network</a></li><li><a class="tocitem" href="../tensor_layer/">Physics-Informed Machine Learning (PIML) with TensorLayer</a></li><li><a class="tocitem" href="../multiple_shooting/">Multiple Shooting</a></li></ul></li><li><span class="tocitem">Layer APIs</span><ul><li><a class="tocitem" href="../../layers/BasisLayers/">Classical Basis Layers</a></li><li><a class="tocitem" href="../../layers/TensorLayer/">Tensor Product Layer</a></li><li><a class="tocitem" href="../../layers/CNFLayer/">Continuous Normalizing Flows Layer</a></li><li><a class="tocitem" href="../../layers/SplineLayer/">Spline Layer</a></li><li><a class="tocitem" href="../../layers/NeuralDELayers/">Neural Differential Equation Layers</a></li><li><a class="tocitem" href="../../layers/HamiltonianNN/">Hamiltonian Neural Network Layer</a></li></ul></li><li><span class="tocitem">Utility Function APIs</span><ul><li><a class="tocitem" href="../../utilities/Collocation/">Smoothed Collocation</a></li><li><a class="tocitem" href="../../utilities/MultipleShooting/">Multiple Shooting Functionality</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Differential Equation Machine Learning Tutorials</a></li><li class="is-active"><a href>Neural Stochastic Differential Equations With Method of Moments</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Neural Stochastic Differential Equations With Method of Moments</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DiffEqFlux.jl/blob/master/docs/src/examples/neural_sde.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Neural-Stochastic-Differential-Equations-With-Method-of-Moments"><a class="docs-heading-anchor" href="#Neural-Stochastic-Differential-Equations-With-Method-of-Moments">Neural Stochastic Differential Equations With Method of Moments</a><a id="Neural-Stochastic-Differential-Equations-With-Method-of-Moments-1"></a><a class="docs-heading-anchor-permalink" href="#Neural-Stochastic-Differential-Equations-With-Method-of-Moments" title="Permalink"></a></h1><p>With neural stochastic differential equations, there is once again a helper form <code>neural_dmsde</code> which can be used for the multiplicative noise case (consult the layers API documentation, or <a href="https://github.com/MikeInnes/zygote-paper/blob/master/neural_sde/neural_sde.jl">this full example using the layer function</a>).</p><p>However, since there are far too many possible combinations for the API to support, in many cases you will want to performantly define neural differential equations for non-ODE systems from scratch. For these systems, it is generally best to use <code>TrackerAdjoint</code> with non-mutating (out-of-place) forms. For example, the following defines a neural SDE with neural networks for both the drift and diffusion terms:</p><pre><code class="language-julia hljs">dudt(u, p, t) = model(u)
g(u, p, t) = model2(u)
prob = SDEProblem(dudt, g, x, tspan, nothing)</code></pre><p>where <code>model</code> and <code>model2</code> are different neural networks. The same can apply to a neural delay differential equation. Its out-of-place formulation is <code>f(u,h,p,t)</code>. Thus for example, if we want to define a neural delay differential equation which uses the history value at <code>p.tau</code> in the past, we can define:</p><pre><code class="language-julia hljs">dudt!(u, h, p, t) = model([u; h(t - p.tau)])
prob = DDEProblem(dudt_, u0, h, tspan, nothing)</code></pre><p>First let&#39;s build training data from the same example as the neural ODE:</p><pre><code class="language-julia hljs">using Plots, Statistics
using Flux, Optimization, OptimizationFlux, DiffEqFlux, StochasticDiffEq, SciMLBase.EnsembleAnalysis

u0 = Float32[2.; 0.]
datasize = 30
tspan = (0.0f0, 1.0f0)
tsteps = range(tspan[1], tspan[2], length = datasize)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.0f0:0.03448276f0:1.0f0</code></pre><pre><code class="language-julia hljs">function trueSDEfunc(du, u, p, t)
    true_A = [-0.1 2.0; -2.0 -0.1]
    du .= ((u.^3)&#39;true_A)&#39;
end

mp = Float32[0.2, 0.2]
function true_noise_func(du, u, p, t)
    du .= mp.*u
end

prob_truesde = SDEProblem(trueSDEfunc, true_noise_func, u0, tspan)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDEProblem with uType Vector{Float32} and tType Float32. In-place: true
timespan: (0.0f0, 1.0f0)
u0: 2-element Vector{Float32}:
 2.0
 0.0</code></pre><p>For our dataset we will use DifferentialEquations.jl&#39;s <a href="https://docs.sciml.ai/DiffEqDocs/stable/features/ensemble/">parallel ensemble interface</a> to generate data from the average of 10,000 runs of the SDE:</p><pre><code class="language-julia hljs"># Take a typical sample from the mean
ensemble_prob = EnsembleProblem(prob_truesde)
ensemble_sol = solve(ensemble_prob, SOSRI(), trajectories = 10000)
ensemble_sum = EnsembleSummary(ensemble_sol)

sde_data, sde_data_vars = Array.(timeseries_point_meanvar(ensemble_sol, tsteps))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Float32[2.0 1.91281 … 0.047135625 0.12712601; 0.0 0.5266071 … -0.6953995 -0.65182316], Float32[0.0 0.07691242 … 1.3288795 1.305707; 0.0 0.057694234 … 0.9502294 0.98791784])</code></pre><p>Now we build a neural SDE. For simplicity we will use the <code>NeuralDSDE</code> neural SDE with diagonal noise layer function:</p><pre><code class="language-julia hljs">drift_dudt = Flux.Chain(x -&gt; x.^3,
                       Flux.Dense(2, 50, tanh),
                       Flux.Dense(50, 2))
p1, re1 = Flux.destructure(drift_dudt)

diffusion_dudt = Flux.Chain(Flux.Dense(2, 2))
p2, re2 = Flux.destructure(diffusion_dudt)

neuralsde = NeuralDSDE(drift_dudt, diffusion_dudt, tspan, SOSRI(),
                       saveat = tsteps, reltol = 1e-1, abstol = 1e-1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NeuralDSDE()</code></pre><p>Let&#39;s see what that looks like:</p><pre><code class="language-julia hljs"># Get the prediction using the correct initial condition
prediction0 = neuralsde(u0)

drift_(u, p, t) = re1(p[1:neuralsde.len])(u)
diffusion_(u, p, t) = re2(p[neuralsde.len+1:end])(u)

prob_neuralsde = SDEProblem(drift_, diffusion_, u0,(0.0f0, 1.2f0), neuralsde.p)

ensemble_nprob = EnsembleProblem(prob_neuralsde)
ensemble_nsol = solve(ensemble_nprob, SOSRI(), trajectories = 100,
                      saveat = tsteps)
ensemble_nsum = EnsembleSummary(ensemble_nsol)

plt1 = plot(ensemble_nsum, title = &quot;Neural SDE: Before Training&quot;)
scatter!(plt1, tsteps, sde_data&#39;, lw = 3)

scatter(tsteps, sde_data[1,:], label = &quot;data&quot;)
scatter!(tsteps, prediction0[1,:], label = &quot;prediction&quot;)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip010">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip010)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip011">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip010)" d="
M138.959 1486.45 L2352.76 1486.45 L2352.76 47.2441 L138.959 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip012">
    <rect x="138" y="47" width="2215" height="1440"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip012)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  201.614,1486.45 201.614,47.2441 
  "/>
<polyline clip-path="url(#clip012)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  723.736,1486.45 723.736,47.2441 
  "/>
<polyline clip-path="url(#clip012)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1245.86,1486.45 1245.86,47.2441 
  "/>
<polyline clip-path="url(#clip012)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1767.98,1486.45 1767.98,47.2441 
  "/>
<polyline clip-path="url(#clip012)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2290.1,1486.45 2290.1,47.2441 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  138.959,1486.45 2352.76,1486.45 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  201.614,1486.45 201.614,1467.55 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  723.736,1486.45 723.736,1467.55 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1245.86,1486.45 1245.86,1467.55 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1767.98,1486.45 1767.98,1467.55 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2290.1,1486.45 2290.1,1467.55 
  "/>
<path clip-path="url(#clip010)" d="M163.917 1517.37 Q160.306 1517.37 158.478 1520.93 Q156.672 1524.47 156.672 1531.6 Q156.672 1538.71 158.478 1542.27 Q160.306 1545.82 163.917 1545.82 Q167.552 1545.82 169.357 1542.27 Q171.186 1538.71 171.186 1531.6 Q171.186 1524.47 169.357 1520.93 Q167.552 1517.37 163.917 1517.37 M163.917 1513.66 Q169.728 1513.66 172.783 1518.27 Q175.862 1522.85 175.862 1531.6 Q175.862 1540.33 172.783 1544.94 Q169.728 1549.52 163.917 1549.52 Q158.107 1549.52 155.029 1544.94 Q151.973 1540.33 151.973 1531.6 Q151.973 1522.85 155.029 1518.27 Q158.107 1513.66 163.917 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M184.079 1542.97 L188.964 1542.97 L188.964 1548.85 L184.079 1548.85 L184.079 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M209.149 1517.37 Q205.538 1517.37 203.709 1520.93 Q201.903 1524.47 201.903 1531.6 Q201.903 1538.71 203.709 1542.27 Q205.538 1545.82 209.149 1545.82 Q212.783 1545.82 214.589 1542.27 Q216.417 1538.71 216.417 1531.6 Q216.417 1524.47 214.589 1520.93 Q212.783 1517.37 209.149 1517.37 M209.149 1513.66 Q214.959 1513.66 218.014 1518.27 Q221.093 1522.85 221.093 1531.6 Q221.093 1540.33 218.014 1544.94 Q214.959 1549.52 209.149 1549.52 Q203.339 1549.52 200.26 1544.94 Q197.204 1540.33 197.204 1531.6 Q197.204 1522.85 200.26 1518.27 Q203.339 1513.66 209.149 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M239.311 1517.37 Q235.7 1517.37 233.871 1520.93 Q232.065 1524.47 232.065 1531.6 Q232.065 1538.71 233.871 1542.27 Q235.7 1545.82 239.311 1545.82 Q242.945 1545.82 244.75 1542.27 Q246.579 1538.71 246.579 1531.6 Q246.579 1524.47 244.75 1520.93 Q242.945 1517.37 239.311 1517.37 M239.311 1513.66 Q245.121 1513.66 248.176 1518.27 Q251.255 1522.85 251.255 1531.6 Q251.255 1540.33 248.176 1544.94 Q245.121 1549.52 239.311 1549.52 Q233.5 1549.52 230.422 1544.94 Q227.366 1540.33 227.366 1531.6 Q227.366 1522.85 230.422 1518.27 Q233.5 1513.66 239.311 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M686.537 1517.37 Q682.926 1517.37 681.097 1520.93 Q679.292 1524.47 679.292 1531.6 Q679.292 1538.71 681.097 1542.27 Q682.926 1545.82 686.537 1545.82 Q690.171 1545.82 691.977 1542.27 Q693.805 1538.71 693.805 1531.6 Q693.805 1524.47 691.977 1520.93 Q690.171 1517.37 686.537 1517.37 M686.537 1513.66 Q692.347 1513.66 695.403 1518.27 Q698.481 1522.85 698.481 1531.6 Q698.481 1540.33 695.403 1544.94 Q692.347 1549.52 686.537 1549.52 Q680.727 1549.52 677.648 1544.94 Q674.593 1540.33 674.593 1531.6 Q674.593 1522.85 677.648 1518.27 Q680.727 1513.66 686.537 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M706.699 1542.97 L711.583 1542.97 L711.583 1548.85 L706.699 1548.85 L706.699 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M725.796 1544.91 L742.115 1544.91 L742.115 1548.85 L720.171 1548.85 L720.171 1544.91 Q722.833 1542.16 727.416 1537.53 Q732.023 1532.88 733.203 1531.53 Q735.449 1529.01 736.328 1527.27 Q737.231 1525.51 737.231 1523.82 Q737.231 1521.07 735.287 1519.33 Q733.365 1517.6 730.264 1517.6 Q728.065 1517.6 725.611 1518.36 Q723.18 1519.13 720.403 1520.68 L720.403 1515.95 Q723.227 1514.82 725.68 1514.24 Q728.134 1513.66 730.171 1513.66 Q735.541 1513.66 738.736 1516.35 Q741.93 1519.03 741.93 1523.52 Q741.93 1525.65 741.12 1527.57 Q740.333 1529.47 738.227 1532.07 Q737.648 1532.74 734.546 1535.95 Q731.444 1539.15 725.796 1544.91 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M751.976 1514.29 L770.333 1514.29 L770.333 1518.22 L756.259 1518.22 L756.259 1526.7 Q757.277 1526.35 758.296 1526.19 Q759.314 1526 760.333 1526 Q766.12 1526 769.5 1529.17 Q772.879 1532.34 772.879 1537.76 Q772.879 1543.34 769.407 1546.44 Q765.935 1549.52 759.615 1549.52 Q757.439 1549.52 755.171 1549.15 Q752.926 1548.78 750.518 1548.04 L750.518 1543.34 Q752.601 1544.47 754.824 1545.03 Q757.046 1545.58 759.523 1545.58 Q763.527 1545.58 765.865 1543.48 Q768.203 1541.37 768.203 1537.76 Q768.203 1534.15 765.865 1532.04 Q763.527 1529.94 759.523 1529.94 Q757.648 1529.94 755.773 1530.35 Q753.921 1530.77 751.976 1531.65 L751.976 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M1208.16 1517.37 Q1204.55 1517.37 1202.72 1520.93 Q1200.92 1524.47 1200.92 1531.6 Q1200.92 1538.71 1202.72 1542.27 Q1204.55 1545.82 1208.16 1545.82 Q1211.8 1545.82 1213.6 1542.27 Q1215.43 1538.71 1215.43 1531.6 Q1215.43 1524.47 1213.6 1520.93 Q1211.8 1517.37 1208.16 1517.37 M1208.16 1513.66 Q1213.97 1513.66 1217.03 1518.27 Q1220.11 1522.85 1220.11 1531.6 Q1220.11 1540.33 1217.03 1544.94 Q1213.97 1549.52 1208.16 1549.52 Q1202.35 1549.52 1199.27 1544.94 Q1196.22 1540.33 1196.22 1531.6 Q1196.22 1522.85 1199.27 1518.27 Q1202.35 1513.66 1208.16 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M1228.32 1542.97 L1233.21 1542.97 L1233.21 1548.85 L1228.32 1548.85 L1228.32 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M1243.44 1514.29 L1261.8 1514.29 L1261.8 1518.22 L1247.72 1518.22 L1247.72 1526.7 Q1248.74 1526.35 1249.76 1526.19 Q1250.78 1526 1251.8 1526 Q1257.58 1526 1260.96 1529.17 Q1264.34 1532.34 1264.34 1537.76 Q1264.34 1543.34 1260.87 1546.44 Q1257.4 1549.52 1251.08 1549.52 Q1248.9 1549.52 1246.63 1549.15 Q1244.39 1548.78 1241.98 1548.04 L1241.98 1543.34 Q1244.06 1544.47 1246.29 1545.03 Q1248.51 1545.58 1250.98 1545.58 Q1254.99 1545.58 1257.33 1543.48 Q1259.67 1541.37 1259.67 1537.76 Q1259.67 1534.15 1257.33 1532.04 Q1254.99 1529.94 1250.98 1529.94 Q1249.11 1529.94 1247.23 1530.35 Q1245.38 1530.77 1243.44 1531.65 L1243.44 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M1283.55 1517.37 Q1279.94 1517.37 1278.11 1520.93 Q1276.31 1524.47 1276.31 1531.6 Q1276.31 1538.71 1278.11 1542.27 Q1279.94 1545.82 1283.55 1545.82 Q1287.19 1545.82 1288.99 1542.27 Q1290.82 1538.71 1290.82 1531.6 Q1290.82 1524.47 1288.99 1520.93 Q1287.19 1517.37 1283.55 1517.37 M1283.55 1513.66 Q1289.36 1513.66 1292.42 1518.27 Q1295.5 1522.85 1295.5 1531.6 Q1295.5 1540.33 1292.42 1544.94 Q1289.36 1549.52 1283.55 1549.52 Q1277.74 1549.52 1274.67 1544.94 Q1271.61 1540.33 1271.61 1531.6 Q1271.61 1522.85 1274.67 1518.27 Q1277.74 1513.66 1283.55 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M1730.78 1517.37 Q1727.17 1517.37 1725.34 1520.93 Q1723.54 1524.47 1723.54 1531.6 Q1723.54 1538.71 1725.34 1542.27 Q1727.17 1545.82 1730.78 1545.82 Q1734.41 1545.82 1736.22 1542.27 Q1738.05 1538.71 1738.05 1531.6 Q1738.05 1524.47 1736.22 1520.93 Q1734.41 1517.37 1730.78 1517.37 M1730.78 1513.66 Q1736.59 1513.66 1739.65 1518.27 Q1742.72 1522.85 1742.72 1531.6 Q1742.72 1540.33 1739.65 1544.94 Q1736.59 1549.52 1730.78 1549.52 Q1724.97 1549.52 1721.89 1544.94 Q1718.84 1540.33 1718.84 1531.6 Q1718.84 1522.85 1721.89 1518.27 Q1724.97 1513.66 1730.78 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M1750.94 1542.97 L1755.83 1542.97 L1755.83 1548.85 L1750.94 1548.85 L1750.94 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M1764.83 1514.29 L1787.05 1514.29 L1787.05 1516.28 L1774.51 1548.85 L1769.62 1548.85 L1781.43 1518.22 L1764.83 1518.22 L1764.83 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M1796.22 1514.29 L1814.58 1514.29 L1814.58 1518.22 L1800.5 1518.22 L1800.5 1526.7 Q1801.52 1526.35 1802.54 1526.19 Q1803.56 1526 1804.58 1526 Q1810.36 1526 1813.74 1529.17 Q1817.12 1532.34 1817.12 1537.76 Q1817.12 1543.34 1813.65 1546.44 Q1810.18 1549.52 1803.86 1549.52 Q1801.68 1549.52 1799.41 1549.15 Q1797.17 1548.78 1794.76 1548.04 L1794.76 1543.34 Q1796.85 1544.47 1799.07 1545.03 Q1801.29 1545.58 1803.77 1545.58 Q1807.77 1545.58 1810.11 1543.48 Q1812.45 1541.37 1812.45 1537.76 Q1812.45 1534.15 1810.11 1532.04 Q1807.77 1529.94 1803.77 1529.94 Q1801.89 1529.94 1800.02 1530.35 Q1798.16 1530.77 1796.22 1531.65 L1796.22 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2242.17 1544.91 L2249.81 1544.91 L2249.81 1518.55 L2241.5 1520.21 L2241.5 1515.95 L2249.77 1514.29 L2254.44 1514.29 L2254.44 1544.91 L2262.08 1544.91 L2262.08 1548.85 L2242.17 1548.85 L2242.17 1544.91 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2271.52 1542.97 L2276.41 1542.97 L2276.41 1548.85 L2271.52 1548.85 L2271.52 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2296.59 1517.37 Q2292.98 1517.37 2291.15 1520.93 Q2289.35 1524.47 2289.35 1531.6 Q2289.35 1538.71 2291.15 1542.27 Q2292.98 1545.82 2296.59 1545.82 Q2300.23 1545.82 2302.03 1542.27 Q2303.86 1538.71 2303.86 1531.6 Q2303.86 1524.47 2302.03 1520.93 Q2300.23 1517.37 2296.59 1517.37 M2296.59 1513.66 Q2302.4 1513.66 2305.46 1518.27 Q2308.54 1522.85 2308.54 1531.6 Q2308.54 1540.33 2305.46 1544.94 Q2302.4 1549.52 2296.59 1549.52 Q2290.78 1549.52 2287.71 1544.94 Q2284.65 1540.33 2284.65 1531.6 Q2284.65 1522.85 2287.71 1518.27 Q2290.78 1513.66 2296.59 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2326.76 1517.37 Q2323.15 1517.37 2321.32 1520.93 Q2319.51 1524.47 2319.51 1531.6 Q2319.51 1538.71 2321.32 1542.27 Q2323.15 1545.82 2326.76 1545.82 Q2330.39 1545.82 2332.2 1542.27 Q2334.02 1538.71 2334.02 1531.6 Q2334.02 1524.47 2332.2 1520.93 Q2330.39 1517.37 2326.76 1517.37 M2326.76 1513.66 Q2332.57 1513.66 2335.62 1518.27 Q2338.7 1522.85 2338.7 1531.6 Q2338.7 1540.33 2335.62 1544.94 Q2332.57 1549.52 2326.76 1549.52 Q2320.95 1549.52 2317.87 1544.94 Q2314.81 1540.33 2314.81 1531.6 Q2314.81 1522.85 2317.87 1518.27 Q2320.95 1513.66 2326.76 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip012)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  138.959,1360.13 2352.76,1360.13 
  "/>
<polyline clip-path="url(#clip012)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  138.959,1022.05 2352.76,1022.05 
  "/>
<polyline clip-path="url(#clip012)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  138.959,683.97 2352.76,683.97 
  "/>
<polyline clip-path="url(#clip012)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  138.959,345.889 2352.76,345.889 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  138.959,1486.45 138.959,47.2441 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  138.959,1360.13 157.857,1360.13 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  138.959,1022.05 157.857,1022.05 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  138.959,683.97 157.857,683.97 
  "/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  138.959,345.889 157.857,345.889 
  "/>
<path clip-path="url(#clip010)" d="M91.0151 1345.93 Q87.404 1345.93 85.5753 1349.49 Q83.7697 1353.04 83.7697 1360.17 Q83.7697 1367.27 85.5753 1370.84 Q87.404 1374.38 91.0151 1374.38 Q94.6493 1374.38 96.4548 1370.84 Q98.2835 1367.27 98.2835 1360.17 Q98.2835 1353.04 96.4548 1349.49 Q94.6493 1345.93 91.0151 1345.93 M91.0151 1342.23 Q96.8252 1342.23 99.8808 1346.83 Q102.959 1351.42 102.959 1360.17 Q102.959 1368.89 99.8808 1373.5 Q96.8252 1378.08 91.0151 1378.08 Q85.2049 1378.08 82.1262 1373.5 Q79.0707 1368.89 79.0707 1360.17 Q79.0707 1351.42 82.1262 1346.83 Q85.2049 1342.23 91.0151 1342.23 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M82.0568 1004.77 L100.413 1004.77 L100.413 1008.71 L86.3392 1008.71 L86.3392 1017.18 Q87.3577 1016.83 88.3762 1016.67 Q89.3947 1016.48 90.4132 1016.48 Q96.2002 1016.48 99.5798 1019.65 Q102.959 1022.83 102.959 1028.24 Q102.959 1033.82 99.4872 1036.92 Q96.015 1040 89.6956 1040 Q87.5197 1040 85.2512 1039.63 Q83.0058 1039.26 80.5984 1038.52 L80.5984 1033.82 Q82.6818 1034.96 84.904 1035.51 Q87.1262 1036.07 89.603 1036.07 Q93.6076 1036.07 95.9456 1033.96 Q98.2835 1031.85 98.2835 1028.24 Q98.2835 1024.63 95.9456 1022.52 Q93.6076 1020.42 89.603 1020.42 Q87.728 1020.42 85.8531 1020.84 Q84.0012 1021.25 82.0568 1022.13 L82.0568 1004.77 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M51.6634 697.315 L59.3023 697.315 L59.3023 670.949 L50.9921 672.616 L50.9921 668.356 L59.256 666.69 L63.9319 666.69 L63.9319 697.315 L71.5707 697.315 L71.5707 701.25 L51.6634 701.25 L51.6634 697.315 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M91.0151 669.768 Q87.404 669.768 85.5753 673.333 Q83.7697 676.875 83.7697 684.004 Q83.7697 691.111 85.5753 694.676 Q87.404 698.217 91.0151 698.217 Q94.6493 698.217 96.4548 694.676 Q98.2835 691.111 98.2835 684.004 Q98.2835 676.875 96.4548 673.333 Q94.6493 669.768 91.0151 669.768 M91.0151 666.065 Q96.8252 666.065 99.8808 670.671 Q102.959 675.255 102.959 684.004 Q102.959 692.731 99.8808 697.338 Q96.8252 701.921 91.0151 701.921 Q85.2049 701.921 82.1262 697.338 Q79.0707 692.731 79.0707 684.004 Q79.0707 675.255 82.1262 670.671 Q85.2049 666.065 91.0151 666.065 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M52.6588 359.234 L60.2976 359.234 L60.2976 332.868 L51.9875 334.535 L51.9875 330.276 L60.2513 328.609 L64.9272 328.609 L64.9272 359.234 L72.5661 359.234 L72.5661 363.169 L52.6588 363.169 L52.6588 359.234 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M82.0568 328.609 L100.413 328.609 L100.413 332.544 L86.3392 332.544 L86.3392 341.016 Q87.3577 340.669 88.3762 340.507 Q89.3947 340.322 90.4132 340.322 Q96.2002 340.322 99.5798 343.493 Q102.959 346.665 102.959 352.081 Q102.959 357.66 99.4872 360.762 Q96.015 363.84 89.6956 363.84 Q87.5197 363.84 85.2512 363.47 Q83.0058 363.1 80.5984 362.359 L80.5984 357.66 Q82.6818 358.794 84.904 359.35 Q87.1262 359.905 89.603 359.905 Q93.6076 359.905 95.9456 357.799 Q98.2835 355.692 98.2835 352.081 Q98.2835 348.47 95.9456 346.364 Q93.6076 344.257 89.603 344.257 Q87.728 344.257 85.8531 344.674 Q84.0012 345.09 82.0568 345.97 L82.0568 328.609 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><circle clip-path="url(#clip012)" cx="201.614" cy="1224.9" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="273.631" cy="1230.79" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="345.648" cy="1236.38" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="417.664" cy="1249.91" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="489.681" cy="1271.26" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="561.698" cy="1297.25" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="633.715" cy="1324.77" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="705.732" cy="1351.51" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="777.748" cy="1375.87" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="849.765" cy="1396.92" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="921.782" cy="1414.17" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="993.799" cy="1427.45" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1065.82" cy="1436.87" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1137.83" cy="1442.81" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1209.85" cy="1445.61" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1281.87" cy="1445.72" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1353.88" cy="1443.49" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1425.9" cy="1439.42" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1497.92" cy="1433.74" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1569.93" cy="1426.8" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1641.95" cy="1419.05" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1713.97" cy="1410.74" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1785.98" cy="1402.08" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1858" cy="1393.44" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1930.02" cy="1385.08" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2002.03" cy="1377.12" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2074.05" cy="1369.75" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2146.07" cy="1363.08" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2218.08" cy="1356.94" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2290.1" cy="1351.54" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="201.614" cy="1224.9" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="273.631" cy="1172.78" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="345.648" cy="1152.62" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="417.664" cy="1173.27" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="489.681" cy="1123.68" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="561.698" cy="1100.18" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="633.715" cy="1026.82" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="705.732" cy="966.243" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="777.748" cy="856.807" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="849.765" cy="880.816" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="921.782" cy="868.047" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="993.799" cy="919.677" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1065.82" cy="902.586" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1137.83" cy="866.615" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1209.85" cy="875.201" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1281.87" cy="909.195" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1353.88" cy="958.02" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1425.9" cy="845.816" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1497.92" cy="697.004" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1569.93" cy="747.847" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1641.95" cy="857.981" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1713.97" cy="897.141" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1785.98" cy="856.85" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1858" cy="788.262" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="1930.02" cy="627.768" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2002.03" cy="467.273" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2074.05" cy="358.43" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2146.07" cy="269.729" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2218.08" cy="180.297" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip012)" cx="2290.1" cy="87.9763" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<path clip-path="url(#clip010)" d="
M1828.07 250.738 L2278.96 250.738 L2278.96 95.2176 L1828.07 95.2176  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip010)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1828.07,250.738 2278.96,250.738 2278.96,95.2176 1828.07,95.2176 1828.07,250.738 
  "/>
<circle clip-path="url(#clip010)" cx="1926.46" cy="147.058" r="23.04" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="5.12"/>
<path clip-path="url(#clip010)" d="M2043.76 142.347 L2043.76 128.319 L2048.02 128.319 L2048.02 164.338 L2043.76 164.338 L2043.76 160.449 Q2042.42 162.763 2040.36 163.898 Q2038.32 165.009 2035.45 165.009 Q2030.76 165.009 2027.79 161.259 Q2024.85 157.509 2024.85 151.398 Q2024.85 145.287 2027.79 141.537 Q2030.76 137.787 2035.45 137.787 Q2038.32 137.787 2040.36 138.921 Q2042.42 140.032 2043.76 142.347 M2029.25 151.398 Q2029.25 156.097 2031.17 158.782 Q2033.12 161.444 2036.5 161.444 Q2039.88 161.444 2041.82 158.782 Q2043.76 156.097 2043.76 151.398 Q2043.76 146.699 2041.82 144.037 Q2039.88 141.352 2036.5 141.352 Q2033.12 141.352 2031.17 144.037 Q2029.25 146.699 2029.25 151.398 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2068.58 151.305 Q2063.42 151.305 2061.43 152.486 Q2059.44 153.666 2059.44 156.514 Q2059.44 158.782 2060.92 160.125 Q2062.42 161.444 2064.99 161.444 Q2068.53 161.444 2070.66 158.944 Q2072.81 156.421 2072.81 152.254 L2072.81 151.305 L2068.58 151.305 M2077.07 149.546 L2077.07 164.338 L2072.81 164.338 L2072.81 160.402 Q2071.36 162.763 2069.18 163.898 Q2067 165.009 2063.86 165.009 Q2059.88 165.009 2057.51 162.787 Q2055.18 160.541 2055.18 156.791 Q2055.18 152.416 2058.09 150.194 Q2061.03 147.972 2066.84 147.972 L2072.81 147.972 L2072.81 147.555 Q2072.81 144.615 2070.87 143.018 Q2068.95 141.398 2065.45 141.398 Q2063.23 141.398 2061.13 141.93 Q2059.02 142.463 2057.07 143.527 L2057.07 139.592 Q2059.41 138.69 2061.61 138.25 Q2063.81 137.787 2065.89 137.787 Q2071.52 137.787 2074.3 140.703 Q2077.07 143.62 2077.07 149.546 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2090.06 131.051 L2090.06 138.412 L2098.83 138.412 L2098.83 141.722 L2090.06 141.722 L2090.06 155.796 Q2090.06 158.967 2090.92 159.87 Q2091.8 160.773 2094.46 160.773 L2098.83 160.773 L2098.83 164.338 L2094.46 164.338 Q2089.53 164.338 2087.65 162.509 Q2085.78 160.657 2085.78 155.796 L2085.78 141.722 L2082.65 141.722 L2082.65 138.412 L2085.78 138.412 L2085.78 131.051 L2090.06 131.051 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2116.22 151.305 Q2111.06 151.305 2109.06 152.486 Q2107.07 153.666 2107.07 156.514 Q2107.07 158.782 2108.56 160.125 Q2110.06 161.444 2112.63 161.444 Q2116.17 161.444 2118.3 158.944 Q2120.45 156.421 2120.45 152.254 L2120.45 151.305 L2116.22 151.305 M2124.71 149.546 L2124.71 164.338 L2120.45 164.338 L2120.45 160.402 Q2119 162.763 2116.82 163.898 Q2114.64 165.009 2111.5 165.009 Q2107.51 165.009 2105.15 162.787 Q2102.81 160.541 2102.81 156.791 Q2102.81 152.416 2105.73 150.194 Q2108.67 147.972 2114.48 147.972 L2120.45 147.972 L2120.45 147.555 Q2120.45 144.615 2118.51 143.018 Q2116.59 141.398 2113.09 141.398 Q2110.87 141.398 2108.76 141.93 Q2106.66 142.463 2104.71 143.527 L2104.71 139.592 Q2107.05 138.69 2109.25 138.25 Q2111.45 137.787 2113.53 137.787 Q2119.16 137.787 2121.94 140.703 Q2124.71 143.62 2124.71 149.546 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><circle clip-path="url(#clip010)" cx="1926.46" cy="198.898" r="23.04" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="5.12"/>
<path clip-path="url(#clip010)" d="M2029.13 212.289 L2029.13 226.039 L2024.85 226.039 L2024.85 190.252 L2029.13 190.252 L2029.13 194.187 Q2030.48 191.872 2032.51 190.761 Q2034.57 189.627 2037.42 189.627 Q2042.14 189.627 2045.08 193.377 Q2048.05 197.127 2048.05 203.238 Q2048.05 209.349 2045.08 213.099 Q2042.14 216.849 2037.42 216.849 Q2034.57 216.849 2032.51 215.738 Q2030.48 214.603 2029.13 212.289 M2043.63 203.238 Q2043.63 198.539 2041.68 195.877 Q2039.76 193.192 2036.38 193.192 Q2033 193.192 2031.06 195.877 Q2029.13 198.539 2029.13 203.238 Q2029.13 207.937 2031.06 210.622 Q2033 213.284 2036.38 213.284 Q2039.76 213.284 2041.68 210.622 Q2043.63 207.937 2043.63 203.238 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2070.13 194.233 Q2069.41 193.817 2068.56 193.631 Q2067.72 193.423 2066.7 193.423 Q2063.09 193.423 2061.15 195.784 Q2059.23 198.122 2059.23 202.52 L2059.23 216.178 L2054.94 216.178 L2054.94 190.252 L2059.23 190.252 L2059.23 194.28 Q2060.57 191.918 2062.72 190.784 Q2064.88 189.627 2067.95 189.627 Q2068.39 189.627 2068.93 189.696 Q2069.46 189.743 2070.11 189.858 L2070.13 194.233 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2095.73 202.15 L2095.73 204.233 L2076.15 204.233 Q2076.43 208.631 2078.79 210.946 Q2081.17 213.238 2085.41 213.238 Q2087.86 213.238 2090.15 212.636 Q2092.47 212.034 2094.74 210.83 L2094.74 214.858 Q2092.44 215.83 2090.04 216.34 Q2087.63 216.849 2085.15 216.849 Q2078.95 216.849 2075.31 213.238 Q2071.7 209.627 2071.7 203.469 Q2071.7 197.104 2075.13 193.377 Q2078.58 189.627 2084.41 189.627 Q2089.64 189.627 2092.68 193.006 Q2095.73 196.363 2095.73 202.15 M2091.47 200.9 Q2091.43 197.405 2089.5 195.321 Q2087.61 193.238 2084.46 193.238 Q2080.89 193.238 2078.74 195.252 Q2076.61 197.266 2076.29 200.923 L2091.47 200.9 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2119.78 194.187 L2119.78 180.159 L2124.04 180.159 L2124.04 216.178 L2119.78 216.178 L2119.78 212.289 Q2118.44 214.603 2116.38 215.738 Q2114.34 216.849 2111.47 216.849 Q2106.77 216.849 2103.81 213.099 Q2100.87 209.349 2100.87 203.238 Q2100.87 197.127 2103.81 193.377 Q2106.77 189.627 2111.47 189.627 Q2114.34 189.627 2116.38 190.761 Q2118.44 191.872 2119.78 194.187 M2105.27 203.238 Q2105.27 207.937 2107.19 210.622 Q2109.13 213.284 2112.51 213.284 Q2115.89 213.284 2117.84 210.622 Q2119.78 207.937 2119.78 203.238 Q2119.78 198.539 2117.84 195.877 Q2115.89 193.192 2112.51 193.192 Q2109.13 193.192 2107.19 195.877 Q2105.27 198.539 2105.27 203.238 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2132.81 190.252 L2137.07 190.252 L2137.07 216.178 L2132.81 216.178 L2132.81 190.252 M2132.81 180.159 L2137.07 180.159 L2137.07 185.553 L2132.81 185.553 L2132.81 180.159 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2164.64 191.247 L2164.64 195.229 Q2162.84 194.233 2161.01 193.747 Q2159.2 193.238 2157.35 193.238 Q2153.21 193.238 2150.92 195.877 Q2148.62 198.492 2148.62 203.238 Q2148.62 207.983 2150.92 210.622 Q2153.21 213.238 2157.35 213.238 Q2159.2 213.238 2161.01 212.752 Q2162.84 212.242 2164.64 211.247 L2164.64 215.182 Q2162.86 216.016 2160.94 216.432 Q2159.04 216.849 2156.89 216.849 Q2151.03 216.849 2147.58 213.168 Q2144.13 209.488 2144.13 203.238 Q2144.13 196.895 2147.61 193.261 Q2151.1 189.627 2157.17 189.627 Q2159.13 189.627 2161.01 190.043 Q2162.88 190.437 2164.64 191.247 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2176.26 182.891 L2176.26 190.252 L2185.04 190.252 L2185.04 193.562 L2176.26 193.562 L2176.26 207.636 Q2176.26 210.807 2177.12 211.71 Q2178 212.613 2180.66 212.613 L2185.04 212.613 L2185.04 216.178 L2180.66 216.178 Q2175.73 216.178 2173.86 214.349 Q2171.98 212.497 2171.98 207.636 L2171.98 193.562 L2168.86 193.562 L2168.86 190.252 L2171.98 190.252 L2171.98 182.891 L2176.26 182.891 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2190.64 190.252 L2194.9 190.252 L2194.9 216.178 L2190.64 216.178 L2190.64 190.252 M2190.64 180.159 L2194.9 180.159 L2194.9 185.553 L2190.64 185.553 L2190.64 180.159 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2213.86 193.238 Q2210.43 193.238 2208.44 195.923 Q2206.45 198.585 2206.45 203.238 Q2206.45 207.891 2208.42 210.576 Q2210.41 213.238 2213.86 213.238 Q2217.26 213.238 2219.25 210.553 Q2221.24 207.867 2221.24 203.238 Q2221.24 198.631 2219.25 195.946 Q2217.26 193.238 2213.86 193.238 M2213.86 189.627 Q2219.41 189.627 2222.58 193.238 Q2225.75 196.849 2225.75 203.238 Q2225.75 209.604 2222.58 213.238 Q2219.41 216.849 2213.86 216.849 Q2208.28 216.849 2205.11 213.238 Q2201.96 209.604 2201.96 203.238 Q2201.96 196.849 2205.11 193.238 Q2208.28 189.627 2213.86 189.627 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip010)" d="M2254.36 200.529 L2254.36 216.178 L2250.11 216.178 L2250.11 200.668 Q2250.11 196.988 2248.67 195.159 Q2247.24 193.33 2244.37 193.33 Q2240.92 193.33 2238.93 195.53 Q2236.93 197.729 2236.93 201.525 L2236.93 216.178 L2232.65 216.178 L2232.65 190.252 L2236.93 190.252 L2236.93 194.28 Q2238.46 191.942 2240.52 190.784 Q2242.61 189.627 2245.31 189.627 Q2249.78 189.627 2252.07 192.405 Q2254.36 195.159 2254.36 200.529 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>Now just as with the neural ODE we define a loss function that calculates the mean and variance from <code>n</code> runs at each time point and uses the distance from the data values:</p><pre><code class="language-julia hljs">function predict_neuralsde(p, u = u0)
  return Array(neuralsde(u, p))
end

function loss_neuralsde(p; n = 100)
  u = repeat(reshape(u0, :, 1), 1, n)
  samples = predict_neuralsde(p, u)
  means = mean(samples, dims = 2)
  vars = var(samples, dims = 2, mean = means)[:, 1, :]
  means = means[:, 1, :]
  loss = sum(abs2, sde_data - means) + sum(abs2, sde_data_vars - vars)
  return loss, means, vars
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">loss_neuralsde (generic function with 1 method)</code></pre><pre><code class="language-julia hljs">list_plots = []
iter = 0

# Callback function to observe training
callback = function (p, loss, means, vars; doplot = false)
  global list_plots, iter

  if iter == 0
    list_plots = []
  end
  iter += 1

  # loss against current data
  display(loss)

  # plot current prediction against data
  plt = Plots.scatter(tsteps, sde_data[1,:], yerror = sde_data_vars[1,:],
                     ylim = (-4.0, 8.0), label = &quot;data&quot;)
  Plots.scatter!(plt, tsteps, means[1,:], ribbon = vars[1,:], label = &quot;prediction&quot;)
  push!(list_plots, plt)

  if doplot
    display(plt)
  end
  return false
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">#4 (generic function with 1 method)</code></pre><p>Now we train using this loss function. We can pre-train a little bit using a smaller <code>n</code> and then decrease it after it has had some time to adjust towards the right mean behavior:</p><pre><code class="language-julia hljs">opt = ADAM(0.025)

# First round of training with n = 10
adtype = Optimization.AutoZygote()
optf = Optimization.OptimizationFunction((x,p) -&gt; loss_neuralsde(x, n=10), adtype)
optprob = Optimization.OptimizationProblem(optf, neuralsde.p)
result1 = Optimization.solve(optprob, opt,
                                 callback = callback, maxiters = 100)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">u: 258-element Vector{Float32}:
  0.153984
 -0.08874108
  0.027504176
 -0.5891622
  0.53691924
  0.29906243
  0.37659684
  0.2757738
  0.73132765
 -0.5324669
  ⋮
  0.040326074
 -0.5143807
 -0.19074605
 -1.3858895
 -0.4876558
 -0.4820839
  0.8281244
  0.45015445
 -0.024609674</code></pre><p>We resume the training with a larger <code>n</code>. (WARNING - this step is a couple of orders of magnitude longer than the previous one).</p><pre><code class="language-julia hljs">optf2 = Optimization.OptimizationFunction((x,p) -&gt; loss_neuralsde(x, n=100), adtype)
optprob2 = Optimization.OptimizationProblem(optf2, result1.u)
result2 = Optimization.solve(optprob2, opt,
                                 callback = callback, maxiters = 100)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">u: 258-element Vector{Float32}:
  0.101751454
 -0.20079337
  0.08703583
 -0.76145226
  0.7235199
  0.30175444
  0.56767243
  0.52306724
  0.8377633
 -0.6432577
  ⋮
 -0.036066633
 -0.59080106
 -0.3144312
 -1.2784811
 -0.46960288
 -0.3715185
  0.85700095
  0.666799
  0.15694143</code></pre><p>And now we plot the solution to an ensemble of the trained neural SDE:</p><pre><code class="language-julia hljs">_, means, vars = loss_neuralsde(result2.u, n = 1000)

plt2 = Plots.scatter(tsteps, sde_data&#39;, yerror = sde_data_vars&#39;,
                     label = &quot;data&quot;, title = &quot;Neural SDE: After Training&quot;,
                     xlabel = &quot;Time&quot;)
plot!(plt2, tsteps, means&#39;, lw = 8, ribbon = vars&#39;, label = &quot;prediction&quot;)

plt = plot(plt1, plt2, layout = (2, 1))
savefig(plt, &quot;NN_sde_combined.png&quot;); nothing # sde</code></pre><p><img src="https://user-images.githubusercontent.com/1814174/76975872-88dc9100-6909-11ea-80f7-242f661ebad1.png" alt/></p><p>Try this with GPUs as well!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../augmented_neural_ode/">« Augmented Neural Ordinary Differential Equations</a><a class="docs-footer-nextpage" href="../collocation/">Smoothed Collocation for Fast Two-Stage Training »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 21 November 2022 22:23">Monday 21 November 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
