<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Neural Stochastic Differential Equations With Method of Moments · DiffEqFlux.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://diffeqflux.sciml.ai/stable/examples/neural_sde/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DiffEqFlux.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DiffEqFlux.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">DiffEqFlux.jl: High Level Scientific Machine Learning (SciML) Pre-Built Architectures</a></li><li><span class="tocitem">Differential Equation Machine Learning Tutorials</span><ul><li><a class="tocitem" href="../neural_ode/">Neural Ordinary Differential Equations</a></li><li><a class="tocitem" href="../GPUs/">Neural ODEs on GPUs</a></li><li><a class="tocitem" href="../mnist_neural_ode/">GPU-based MNIST Neural ODE Classifier</a></li><li><a class="tocitem" href="../mnist_conv_neural_ode/">Convolutional Neural ODE MNIST Classifier on GPU</a></li><li><a class="tocitem" href="../augmented_neural_ode/">Augmented Neural Ordinary Differential Equations</a></li><li class="is-active"><a class="tocitem" href>Neural Stochastic Differential Equations With Method of Moments</a></li><li><a class="tocitem" href="../collocation/">Smoothed Collocation for Fast Two-Stage Training</a></li><li><a class="tocitem" href="../normalizing_flows/">Continuous Normalizing Flows</a></li><li><a class="tocitem" href="../hamiltonian_nn/">Hamiltonian Neural Network</a></li><li><a class="tocitem" href="../tensor_layer/">Physics-Informed Machine Learning (PIML) with TensorLayer</a></li><li><a class="tocitem" href="../multiple_shooting/">Multiple Shooting</a></li></ul></li><li><span class="tocitem">Layer APIs</span><ul><li><a class="tocitem" href="../../layers/BasisLayers/">Classical Basis Layers</a></li><li><a class="tocitem" href="../../layers/TensorLayer/">Tensor Product Layer</a></li><li><a class="tocitem" href="../../layers/CNFLayer/">Continuous Normalizing Flows Layer</a></li><li><a class="tocitem" href="../../layers/SplineLayer/">Spline Layer</a></li><li><a class="tocitem" href="../../layers/NeuralDELayers/">Neural Differential Equation Layers</a></li><li><a class="tocitem" href="../../layers/HamiltonianNN/">Hamiltonian Neural Network Layer</a></li></ul></li><li><span class="tocitem">Utility Function APIs</span><ul><li><a class="tocitem" href="../../utilities/Collocation/">Smoothed Collocation</a></li><li><a class="tocitem" href="../../utilities/MultipleShooting/">Multiple Shooting Functionality</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Differential Equation Machine Learning Tutorials</a></li><li class="is-active"><a href>Neural Stochastic Differential Equations With Method of Moments</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Neural Stochastic Differential Equations With Method of Moments</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DiffEqFlux.jl/blob/master/docs/src/examples/neural_sde.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Neural-Stochastic-Differential-Equations-With-Method-of-Moments"><a class="docs-heading-anchor" href="#Neural-Stochastic-Differential-Equations-With-Method-of-Moments">Neural Stochastic Differential Equations With Method of Moments</a><a id="Neural-Stochastic-Differential-Equations-With-Method-of-Moments-1"></a><a class="docs-heading-anchor-permalink" href="#Neural-Stochastic-Differential-Equations-With-Method-of-Moments" title="Permalink"></a></h1><p>With neural stochastic differential equations, there is once again a helper form <code>neural_dmsde</code> which can be used for the multiplicative noise case (consult the layers API documentation, or <a href="https://github.com/MikeInnes/zygote-paper/blob/master/neural_sde/neural_sde.jl">this full example using the layer function</a>).</p><p>However, since there are far too many possible combinations for the API to support, in many cases you will want to performantly define neural differential equations for non-ODE systems from scratch. For these systems, it is generally best to use <code>TrackerAdjoint</code> with non-mutating (out-of-place) forms. For example, the following defines a neural SDE with neural networks for both the drift and diffusion terms:</p><pre><code class="language-julia hljs">dudt(u, p, t) = model(u)
g(u, p, t) = model2(u)
prob = SDEProblem(dudt, g, x, tspan, nothing)</code></pre><p>where <code>model</code> and <code>model2</code> are different neural networks. The same can apply to a neural delay differential equation. Its out-of-place formulation is <code>f(u,h,p,t)</code>. Thus for example, if we want to define a neural delay differential equation which uses the history value at <code>p.tau</code> in the past, we can define:</p><pre><code class="language-julia hljs">dudt!(u, h, p, t) = model([u; h(t - p.tau)])
prob = DDEProblem(dudt_, u0, h, tspan, nothing)</code></pre><p>First let&#39;s build training data from the same example as the neural ODE:</p><pre><code class="language-julia hljs">using Plots, Statistics
using Flux, Optimization, OptimizationFlux, DiffEqFlux, StochasticDiffEq, SciMLBase.EnsembleAnalysis

u0 = Float32[2.; 0.]
datasize = 30
tspan = (0.0f0, 1.0f0)
tsteps = range(tspan[1], tspan[2], length = datasize)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.0f0:0.03448276f0:1.0f0</code></pre><pre><code class="language-julia hljs">function trueSDEfunc(du, u, p, t)
    true_A = [-0.1 2.0; -2.0 -0.1]
    du .= ((u.^3)&#39;true_A)&#39;
end

mp = Float32[0.2, 0.2]
function true_noise_func(du, u, p, t)
    du .= mp.*u
end

prob_truesde = SDEProblem(trueSDEfunc, true_noise_func, u0, tspan)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDEProblem with uType Vector{Float32} and tType Float32. In-place: true
timespan: (0.0f0, 1.0f0)
u0: 2-element Vector{Float32}:
 2.0
 0.0</code></pre><p>For our dataset we will use DifferentialEquations.jl&#39;s <a href="http://docs.juliadiffeq.org/dev/features/ensemble.html">parallel ensemble interface</a> to generate data from the average of 10,000 runs of the SDE:</p><pre><code class="language-julia hljs"># Take a typical sample from the mean
ensemble_prob = EnsembleProblem(prob_truesde)
ensemble_sol = solve(ensemble_prob, SOSRI(), trajectories = 10000)
ensemble_sum = EnsembleSummary(ensemble_sol)

sde_data, sde_data_vars = Array.(timeseries_point_meanvar(ensemble_sol, tsteps))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Float32[2.0 1.9152838 … 0.04818673 0.12328281; 0.0 0.529384 … -0.6745827 -0.63105357], Float32[0.0 0.076872624 … 1.3235786 1.2922523; 0.0 0.057938546 … 0.9938907 1.029242])</code></pre><p>Now we build a neural SDE. For simplicity we will use the <code>NeuralDSDE</code> neural SDE with diagonal noise layer function:</p><pre><code class="language-julia hljs">drift_dudt = Flux.Chain(x -&gt; x.^3,
                       Flux.Dense(2, 50, tanh),
                       Flux.Dense(50, 2))
p1, re1 = Flux.destructure(drift_dudt)

diffusion_dudt = Flux.Chain(Flux.Dense(2, 2))
p2, re2 = Flux.destructure(diffusion_dudt)

neuralsde = NeuralDSDE(drift_dudt, diffusion_dudt, tspan, SOSRI(),
                       saveat = tsteps, reltol = 1e-1, abstol = 1e-1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">NeuralDSDE()</code></pre><p>Let&#39;s see what that looks like:</p><pre><code class="language-julia hljs"># Get the prediction using the correct initial condition
prediction0 = neuralsde(u0)

drift_(u, p, t) = re1(p[1:neuralsde.len])(u)
diffusion_(u, p, t) = re2(p[neuralsde.len+1:end])(u)

prob_neuralsde = SDEProblem(drift_, diffusion_, u0,(0.0f0, 1.2f0), neuralsde.p)

ensemble_nprob = EnsembleProblem(prob_neuralsde)
ensemble_nsol = solve(ensemble_nprob, SOSRI(), trajectories = 100,
                      saveat = tsteps)
ensemble_nsum = EnsembleSummary(ensemble_nsol)

plt1 = plot(ensemble_nsum, title = &quot;Neural SDE: Before Training&quot;)
scatter!(plt1, tsteps, sde_data&#39;, lw = 3)

scatter(tsteps, sde_data[1,:], label = &quot;data&quot;)
scatter!(tsteps, prediction0[1,:], label = &quot;prediction&quot;)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip830">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip830)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip831">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip830)" d="
M147.478 1486.45 L2352.76 1486.45 L2352.76 47.2441 L147.478 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip832">
    <rect x="147" y="47" width="2206" height="1440"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  209.891,1486.45 209.891,47.2441 
  "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  730.004,1486.45 730.004,47.2441 
  "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1250.12,1486.45 1250.12,47.2441 
  "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1770.23,1486.45 1770.23,47.2441 
  "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2290.34,1486.45 2290.34,47.2441 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  147.478,1486.45 2352.76,1486.45 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  209.891,1486.45 209.891,1467.55 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  730.004,1486.45 730.004,1467.55 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1250.12,1486.45 1250.12,1467.55 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1770.23,1486.45 1770.23,1467.55 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2290.34,1486.45 2290.34,1467.55 
  "/>
<path clip-path="url(#clip830)" d="M172.195 1517.37 Q168.584 1517.37 166.755 1520.93 Q164.95 1524.47 164.95 1531.6 Q164.95 1538.71 166.755 1542.27 Q168.584 1545.82 172.195 1545.82 Q175.829 1545.82 177.635 1542.27 Q179.463 1538.71 179.463 1531.6 Q179.463 1524.47 177.635 1520.93 Q175.829 1517.37 172.195 1517.37 M172.195 1513.66 Q178.005 1513.66 181.061 1518.27 Q184.139 1522.85 184.139 1531.6 Q184.139 1540.33 181.061 1544.94 Q178.005 1549.52 172.195 1549.52 Q166.385 1549.52 163.306 1544.94 Q160.251 1540.33 160.251 1531.6 Q160.251 1522.85 163.306 1518.27 Q166.385 1513.66 172.195 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M192.357 1542.97 L197.241 1542.97 L197.241 1548.85 L192.357 1548.85 L192.357 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M217.426 1517.37 Q213.815 1517.37 211.986 1520.93 Q210.181 1524.47 210.181 1531.6 Q210.181 1538.71 211.986 1542.27 Q213.815 1545.82 217.426 1545.82 Q221.06 1545.82 222.866 1542.27 Q224.695 1538.71 224.695 1531.6 Q224.695 1524.47 222.866 1520.93 Q221.06 1517.37 217.426 1517.37 M217.426 1513.66 Q223.236 1513.66 226.292 1518.27 Q229.371 1522.85 229.371 1531.6 Q229.371 1540.33 226.292 1544.94 Q223.236 1549.52 217.426 1549.52 Q211.616 1549.52 208.537 1544.94 Q205.482 1540.33 205.482 1531.6 Q205.482 1522.85 208.537 1518.27 Q211.616 1513.66 217.426 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M247.588 1517.37 Q243.977 1517.37 242.148 1520.93 Q240.343 1524.47 240.343 1531.6 Q240.343 1538.71 242.148 1542.27 Q243.977 1545.82 247.588 1545.82 Q251.222 1545.82 253.028 1542.27 Q254.856 1538.71 254.856 1531.6 Q254.856 1524.47 253.028 1520.93 Q251.222 1517.37 247.588 1517.37 M247.588 1513.66 Q253.398 1513.66 256.454 1518.27 Q259.532 1522.85 259.532 1531.6 Q259.532 1540.33 256.454 1544.94 Q253.398 1549.52 247.588 1549.52 Q241.778 1549.52 238.699 1544.94 Q235.644 1540.33 235.644 1531.6 Q235.644 1522.85 238.699 1518.27 Q241.778 1513.66 247.588 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M692.805 1517.37 Q689.194 1517.37 687.366 1520.93 Q685.56 1524.47 685.56 1531.6 Q685.56 1538.71 687.366 1542.27 Q689.194 1545.82 692.805 1545.82 Q696.44 1545.82 698.245 1542.27 Q700.074 1538.71 700.074 1531.6 Q700.074 1524.47 698.245 1520.93 Q696.44 1517.37 692.805 1517.37 M692.805 1513.66 Q698.615 1513.66 701.671 1518.27 Q704.75 1522.85 704.75 1531.6 Q704.75 1540.33 701.671 1544.94 Q698.615 1549.52 692.805 1549.52 Q686.995 1549.52 683.916 1544.94 Q680.861 1540.33 680.861 1531.6 Q680.861 1522.85 683.916 1518.27 Q686.995 1513.66 692.805 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M712.967 1542.97 L717.851 1542.97 L717.851 1548.85 L712.967 1548.85 L712.967 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M732.064 1544.91 L748.384 1544.91 L748.384 1548.85 L726.439 1548.85 L726.439 1544.91 Q729.101 1542.16 733.685 1537.53 Q738.291 1532.88 739.472 1531.53 Q741.717 1529.01 742.597 1527.27 Q743.499 1525.51 743.499 1523.82 Q743.499 1521.07 741.555 1519.33 Q739.634 1517.6 736.532 1517.6 Q734.333 1517.6 731.879 1518.36 Q729.449 1519.13 726.671 1520.68 L726.671 1515.95 Q729.495 1514.82 731.949 1514.24 Q734.402 1513.66 736.439 1513.66 Q741.81 1513.66 745.004 1516.35 Q748.199 1519.03 748.199 1523.52 Q748.199 1525.65 747.388 1527.57 Q746.601 1529.47 744.495 1532.07 Q743.916 1532.74 740.814 1535.95 Q737.712 1539.15 732.064 1544.91 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M758.245 1514.29 L776.601 1514.29 L776.601 1518.22 L762.527 1518.22 L762.527 1526.7 Q763.546 1526.35 764.564 1526.19 Q765.583 1526 766.601 1526 Q772.388 1526 775.768 1529.17 Q779.147 1532.34 779.147 1537.76 Q779.147 1543.34 775.675 1546.44 Q772.203 1549.52 765.884 1549.52 Q763.708 1549.52 761.439 1549.15 Q759.194 1548.78 756.786 1548.04 L756.786 1543.34 Q758.87 1544.47 761.092 1545.03 Q763.314 1545.58 765.791 1545.58 Q769.796 1545.58 772.134 1543.48 Q774.472 1541.37 774.472 1537.76 Q774.472 1534.15 772.134 1532.04 Q769.796 1529.94 765.791 1529.94 Q763.916 1529.94 762.041 1530.35 Q760.189 1530.77 758.245 1531.65 L758.245 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1212.42 1517.37 Q1208.81 1517.37 1206.98 1520.93 Q1205.18 1524.47 1205.18 1531.6 Q1205.18 1538.71 1206.98 1542.27 Q1208.81 1545.82 1212.42 1545.82 Q1216.05 1545.82 1217.86 1542.27 Q1219.69 1538.71 1219.69 1531.6 Q1219.69 1524.47 1217.86 1520.93 Q1216.05 1517.37 1212.42 1517.37 M1212.42 1513.66 Q1218.23 1513.66 1221.29 1518.27 Q1224.36 1522.85 1224.36 1531.6 Q1224.36 1540.33 1221.29 1544.94 Q1218.23 1549.52 1212.42 1549.52 Q1206.61 1549.52 1203.53 1544.94 Q1200.48 1540.33 1200.48 1531.6 Q1200.48 1522.85 1203.53 1518.27 Q1206.61 1513.66 1212.42 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1232.58 1542.97 L1237.47 1542.97 L1237.47 1548.85 L1232.58 1548.85 L1232.58 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1247.7 1514.29 L1266.05 1514.29 L1266.05 1518.22 L1251.98 1518.22 L1251.98 1526.7 Q1253 1526.35 1254.02 1526.19 Q1255.04 1526 1256.05 1526 Q1261.84 1526 1265.22 1529.17 Q1268.6 1532.34 1268.6 1537.76 Q1268.6 1543.34 1265.13 1546.44 Q1261.66 1549.52 1255.34 1549.52 Q1253.16 1549.52 1250.89 1549.15 Q1248.65 1548.78 1246.24 1548.04 L1246.24 1543.34 Q1248.32 1544.47 1250.55 1545.03 Q1252.77 1545.58 1255.24 1545.58 Q1259.25 1545.58 1261.59 1543.48 Q1263.92 1541.37 1263.92 1537.76 Q1263.92 1534.15 1261.59 1532.04 Q1259.25 1529.94 1255.24 1529.94 Q1253.37 1529.94 1251.49 1530.35 Q1249.64 1530.77 1247.7 1531.65 L1247.7 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1287.81 1517.37 Q1284.2 1517.37 1282.37 1520.93 Q1280.57 1524.47 1280.57 1531.6 Q1280.57 1538.71 1282.37 1542.27 Q1284.2 1545.82 1287.81 1545.82 Q1291.45 1545.82 1293.25 1542.27 Q1295.08 1538.71 1295.08 1531.6 Q1295.08 1524.47 1293.25 1520.93 Q1291.45 1517.37 1287.81 1517.37 M1287.81 1513.66 Q1293.62 1513.66 1296.68 1518.27 Q1299.76 1522.85 1299.76 1531.6 Q1299.76 1540.33 1296.68 1544.94 Q1293.62 1549.52 1287.81 1549.52 Q1282 1549.52 1278.92 1544.94 Q1275.87 1540.33 1275.87 1531.6 Q1275.87 1522.85 1278.92 1518.27 Q1282 1513.66 1287.81 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1733.03 1517.37 Q1729.42 1517.37 1727.59 1520.93 Q1725.79 1524.47 1725.79 1531.6 Q1725.79 1538.71 1727.59 1542.27 Q1729.42 1545.82 1733.03 1545.82 Q1736.67 1545.82 1738.47 1542.27 Q1740.3 1538.71 1740.3 1531.6 Q1740.3 1524.47 1738.47 1520.93 Q1736.67 1517.37 1733.03 1517.37 M1733.03 1513.66 Q1738.84 1513.66 1741.9 1518.27 Q1744.98 1522.85 1744.98 1531.6 Q1744.98 1540.33 1741.9 1544.94 Q1738.84 1549.52 1733.03 1549.52 Q1727.22 1549.52 1724.14 1544.94 Q1721.09 1540.33 1721.09 1531.6 Q1721.09 1522.85 1724.14 1518.27 Q1727.22 1513.66 1733.03 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1753.19 1542.97 L1758.08 1542.97 L1758.08 1548.85 L1753.19 1548.85 L1753.19 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1767.08 1514.29 L1789.3 1514.29 L1789.3 1516.28 L1776.76 1548.85 L1771.87 1548.85 L1783.68 1518.22 L1767.08 1518.22 L1767.08 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1798.47 1514.29 L1816.83 1514.29 L1816.83 1518.22 L1802.75 1518.22 L1802.75 1526.7 Q1803.77 1526.35 1804.79 1526.19 Q1805.81 1526 1806.83 1526 Q1812.61 1526 1815.99 1529.17 Q1819.37 1532.34 1819.37 1537.76 Q1819.37 1543.34 1815.9 1546.44 Q1812.43 1549.52 1806.11 1549.52 Q1803.93 1549.52 1801.66 1549.15 Q1799.42 1548.78 1797.01 1548.04 L1797.01 1543.34 Q1799.1 1544.47 1801.32 1545.03 Q1803.54 1545.58 1806.02 1545.58 Q1810.02 1545.58 1812.36 1543.48 Q1814.7 1541.37 1814.7 1537.76 Q1814.7 1534.15 1812.36 1532.04 Q1810.02 1529.94 1806.02 1529.94 Q1804.14 1529.94 1802.27 1530.35 Q1800.41 1530.77 1798.47 1531.65 L1798.47 1514.29 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2242.41 1544.91 L2250.05 1544.91 L2250.05 1518.55 L2241.74 1520.21 L2241.74 1515.95 L2250.01 1514.29 L2254.68 1514.29 L2254.68 1544.91 L2262.32 1544.91 L2262.32 1548.85 L2242.41 1548.85 L2242.41 1544.91 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2271.77 1542.97 L2276.65 1542.97 L2276.65 1548.85 L2271.77 1548.85 L2271.77 1542.97 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2296.84 1517.37 Q2293.22 1517.37 2291.4 1520.93 Q2289.59 1524.47 2289.59 1531.6 Q2289.59 1538.71 2291.4 1542.27 Q2293.22 1545.82 2296.84 1545.82 Q2300.47 1545.82 2302.28 1542.27 Q2304.1 1538.71 2304.1 1531.6 Q2304.1 1524.47 2302.28 1520.93 Q2300.47 1517.37 2296.84 1517.37 M2296.84 1513.66 Q2302.65 1513.66 2305.7 1518.27 Q2308.78 1522.85 2308.78 1531.6 Q2308.78 1540.33 2305.7 1544.94 Q2302.65 1549.52 2296.84 1549.52 Q2291.03 1549.52 2287.95 1544.94 Q2284.89 1540.33 2284.89 1531.6 Q2284.89 1522.85 2287.95 1518.27 Q2291.03 1513.66 2296.84 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2327 1517.37 Q2323.39 1517.37 2321.56 1520.93 Q2319.75 1524.47 2319.75 1531.6 Q2319.75 1538.71 2321.56 1542.27 Q2323.39 1545.82 2327 1545.82 Q2330.63 1545.82 2332.44 1542.27 Q2334.27 1538.71 2334.27 1531.6 Q2334.27 1524.47 2332.44 1520.93 Q2330.63 1517.37 2327 1517.37 M2327 1513.66 Q2332.81 1513.66 2335.86 1518.27 Q2338.94 1522.85 2338.94 1531.6 Q2338.94 1540.33 2335.86 1544.94 Q2332.81 1549.52 2327 1549.52 Q2321.19 1549.52 2318.11 1544.94 Q2315.05 1540.33 2315.05 1531.6 Q2315.05 1522.85 2318.11 1518.27 Q2321.19 1513.66 2327 1513.66 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  147.478,1339.98 2352.76,1339.98 
  "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  147.478,941.347 2352.76,941.347 
  "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  147.478,542.709 2352.76,542.709 
  "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  147.478,144.072 2352.76,144.072 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  147.478,1486.45 147.478,47.2441 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  147.478,1339.98 166.376,1339.98 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  147.478,941.347 166.376,941.347 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  147.478,542.709 166.376,542.709 
  "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  147.478,144.072 166.376,144.072 
  "/>
<path clip-path="url(#clip830)" d="M50.9921 1340.44 L80.6679 1340.44 L80.6679 1344.37 L50.9921 1344.37 L50.9921 1340.44 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M91.5706 1353.33 L99.2095 1353.33 L99.2095 1326.96 L90.8993 1328.63 L90.8993 1324.37 L99.1632 1322.7 L103.839 1322.7 L103.839 1353.33 L111.478 1353.33 L111.478 1357.26 L91.5706 1357.26 L91.5706 1353.33 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M99.5335 927.145 Q95.9224 927.145 94.0937 930.71 Q92.2882 934.252 92.2882 941.381 Q92.2882 948.488 94.0937 952.052 Q95.9224 955.594 99.5335 955.594 Q103.168 955.594 104.973 952.052 Q106.802 948.488 106.802 941.381 Q106.802 934.252 104.973 930.71 Q103.168 927.145 99.5335 927.145 M99.5335 923.442 Q105.344 923.442 108.399 928.048 Q111.478 932.631 111.478 941.381 Q111.478 950.108 108.399 954.715 Q105.344 959.298 99.5335 959.298 Q93.7234 959.298 90.6447 954.715 Q87.5892 950.108 87.5892 941.381 Q87.5892 932.631 90.6447 928.048 Q93.7234 923.442 99.5335 923.442 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M91.5706 556.054 L99.2095 556.054 L99.2095 529.689 L90.8993 531.355 L90.8993 527.096 L99.1632 525.429 L103.839 525.429 L103.839 556.054 L111.478 556.054 L111.478 559.989 L91.5706 559.989 L91.5706 556.054 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M95.1586 157.417 L111.478 157.417 L111.478 161.352 L89.5336 161.352 L89.5336 157.417 Q92.1956 154.662 96.7789 150.033 Q101.385 145.38 102.566 144.037 Q104.811 141.514 105.691 139.778 Q106.594 138.019 106.594 136.329 Q106.594 133.575 104.649 131.838 Q102.728 130.102 99.6261 130.102 Q97.4271 130.102 94.9734 130.866 Q92.5428 131.63 89.7651 133.181 L89.7651 128.459 Q92.5891 127.325 95.0428 126.746 Q97.4965 126.167 99.5335 126.167 Q104.904 126.167 108.098 128.852 Q111.293 131.538 111.293 136.028 Q111.293 138.158 110.483 140.079 Q109.696 141.977 107.589 144.57 Q107.01 145.241 103.909 148.459 Q100.807 151.653 95.1586 157.417 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><circle clip-path="url(#clip832)" cx="209.891" cy="144.072" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="281.631" cy="177.843" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="353.371" cy="211.275" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="425.111" cy="290.744" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="496.85" cy="417.546" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="568.59" cy="572.372" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="640.33" cy="735.716" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="712.069" cy="894.222" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="783.809" cy="1038.7" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="855.549" cy="1163.24" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="927.288" cy="1264.89" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="999.028" cy="1342.69" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1070.77" cy="1397.48" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1142.51" cy="1430.98" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1214.25" cy="1445.72" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1285.99" cy="1444.64" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1357.73" cy="1429.23" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1429.47" cy="1402.81" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1501.21" cy="1367.97" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1572.95" cy="1326.48" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1644.69" cy="1280.82" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1716.42" cy="1231.98" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1788.16" cy="1182.26" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1859.9" cy="1132.54" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1931.64" cy="1084.34" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2003.38" cy="1038.38" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2075.12" cy="995.719" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2146.86" cy="956.718" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2218.6" cy="922.138" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2290.34" cy="892.201" r="14.4" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="209.891" cy="144.072" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="281.631" cy="87.9763" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="353.371" cy="90.9603" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="425.111" cy="142.151" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="496.85" cy="140.488" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="568.59" cy="137.86" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="640.33" cy="172.657" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="712.069" cy="238.845" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="783.809" cy="282.549" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="855.549" cy="278.356" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="927.288" cy="280.524" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="999.028" cy="294.446" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1070.77" cy="314.237" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1142.51" cy="293.458" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1214.25" cy="303.47" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1285.99" cy="319.536" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1357.73" cy="333.846" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1429.47" cy="338.676" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1501.21" cy="343.804" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1572.95" cy="349.474" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1644.69" cy="354.909" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1716.42" cy="360.269" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1788.16" cy="361.358" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1859.9" cy="363.04" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="1931.64" cy="369.939" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2003.38" cy="376.637" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2075.12" cy="381.776" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2146.86" cy="386.95" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2218.6" cy="393.978" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip832)" cx="2290.34" cy="401.005" r="14.4" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<path clip-path="url(#clip830)" d="
M1804.7 250.738 L2279.25 250.738 L2279.25 95.2176 L1804.7 95.2176  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1804.7,250.738 2279.25,250.738 2279.25,95.2176 1804.7,95.2176 1804.7,250.738 
  "/>
<circle clip-path="url(#clip830)" cx="1902.72" cy="147.058" r="23.04" fill="#009af9" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="5.12"/>
<path clip-path="url(#clip830)" d="M2019.64 142.347 L2019.64 128.319 L2023.9 128.319 L2023.9 164.338 L2019.64 164.338 L2019.64 160.449 Q2018.3 162.763 2016.24 163.898 Q2014.2 165.009 2011.33 165.009 Q2006.63 165.009 2003.67 161.259 Q2000.73 157.509 2000.73 151.398 Q2000.73 145.287 2003.67 141.537 Q2006.63 137.787 2011.33 137.787 Q2014.2 137.787 2016.24 138.921 Q2018.3 140.032 2019.64 142.347 M2005.13 151.398 Q2005.13 156.097 2007.05 158.782 Q2008.99 161.444 2012.37 161.444 Q2015.75 161.444 2017.7 158.782 Q2019.64 156.097 2019.64 151.398 Q2019.64 146.699 2017.7 144.037 Q2015.75 141.352 2012.37 141.352 Q2008.99 141.352 2007.05 144.037 Q2005.13 146.699 2005.13 151.398 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2044.45 151.305 Q2039.29 151.305 2037.3 152.486 Q2035.31 153.666 2035.31 156.514 Q2035.31 158.782 2036.79 160.125 Q2038.3 161.444 2040.87 161.444 Q2044.41 161.444 2046.54 158.944 Q2048.69 156.421 2048.69 152.254 L2048.69 151.305 L2044.45 151.305 M2052.95 149.546 L2052.95 164.338 L2048.69 164.338 L2048.69 160.402 Q2047.23 162.763 2045.06 163.898 Q2042.88 165.009 2039.73 165.009 Q2035.75 165.009 2033.39 162.787 Q2031.05 160.541 2031.05 156.791 Q2031.05 152.416 2033.97 150.194 Q2036.91 147.972 2042.72 147.972 L2048.69 147.972 L2048.69 147.555 Q2048.69 144.615 2046.75 143.018 Q2044.82 141.398 2041.33 141.398 Q2039.11 141.398 2037 141.93 Q2034.89 142.463 2032.95 143.527 L2032.95 139.592 Q2035.29 138.69 2037.49 138.25 Q2039.69 137.787 2041.77 137.787 Q2047.39 137.787 2050.17 140.703 Q2052.95 143.62 2052.95 149.546 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2065.94 131.051 L2065.94 138.412 L2074.71 138.412 L2074.71 141.722 L2065.94 141.722 L2065.94 155.796 Q2065.94 158.967 2066.79 159.87 Q2067.67 160.773 2070.33 160.773 L2074.71 160.773 L2074.71 164.338 L2070.33 164.338 Q2065.4 164.338 2063.53 162.509 Q2061.65 160.657 2061.65 155.796 L2061.65 141.722 L2058.53 141.722 L2058.53 138.412 L2061.65 138.412 L2061.65 131.051 L2065.94 131.051 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2092.09 151.305 Q2086.93 151.305 2084.94 152.486 Q2082.95 153.666 2082.95 156.514 Q2082.95 158.782 2084.43 160.125 Q2085.94 161.444 2088.51 161.444 Q2092.05 161.444 2094.18 158.944 Q2096.33 156.421 2096.33 152.254 L2096.33 151.305 L2092.09 151.305 M2100.59 149.546 L2100.59 164.338 L2096.33 164.338 L2096.33 160.402 Q2094.87 162.763 2092.69 163.898 Q2090.52 165.009 2087.37 165.009 Q2083.39 165.009 2081.03 162.787 Q2078.69 160.541 2078.69 156.791 Q2078.69 152.416 2081.61 150.194 Q2084.55 147.972 2090.36 147.972 L2096.33 147.972 L2096.33 147.555 Q2096.33 144.615 2094.38 143.018 Q2092.46 141.398 2088.97 141.398 Q2086.75 141.398 2084.64 141.93 Q2082.53 142.463 2080.59 143.527 L2080.59 139.592 Q2082.93 138.69 2085.13 138.25 Q2087.32 137.787 2089.41 137.787 Q2095.03 137.787 2097.81 140.703 Q2100.59 143.62 2100.59 149.546 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><circle clip-path="url(#clip830)" cx="1902.72" cy="198.898" r="23.04" fill="#e26f46" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="5.12"/>
<path clip-path="url(#clip830)" d="M2005.01 212.289 L2005.01 226.039 L2000.73 226.039 L2000.73 190.252 L2005.01 190.252 L2005.01 194.187 Q2006.35 191.872 2008.39 190.761 Q2010.45 189.627 2013.3 189.627 Q2018.02 189.627 2020.96 193.377 Q2023.92 197.127 2023.92 203.238 Q2023.92 209.349 2020.96 213.099 Q2018.02 216.849 2013.3 216.849 Q2010.45 216.849 2008.39 215.738 Q2006.35 214.603 2005.01 212.289 M2019.5 203.238 Q2019.5 198.539 2017.56 195.877 Q2015.64 193.192 2012.26 193.192 Q2008.88 193.192 2006.93 195.877 Q2005.01 198.539 2005.01 203.238 Q2005.01 207.937 2006.93 210.622 Q2008.88 213.284 2012.26 213.284 Q2015.64 213.284 2017.56 210.622 Q2019.5 207.937 2019.5 203.238 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2046.01 194.233 Q2045.29 193.817 2044.43 193.631 Q2043.6 193.423 2042.58 193.423 Q2038.97 193.423 2037.02 195.784 Q2035.1 198.122 2035.1 202.52 L2035.1 216.178 L2030.82 216.178 L2030.82 190.252 L2035.1 190.252 L2035.1 194.28 Q2036.45 191.918 2038.6 190.784 Q2040.75 189.627 2043.83 189.627 Q2044.27 189.627 2044.8 189.696 Q2045.33 189.743 2045.98 189.858 L2046.01 194.233 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2071.61 202.15 L2071.61 204.233 L2052.02 204.233 Q2052.3 208.631 2054.66 210.946 Q2057.05 213.238 2061.28 213.238 Q2063.74 213.238 2066.03 212.636 Q2068.34 212.034 2070.61 210.83 L2070.61 214.858 Q2068.32 215.83 2065.91 216.34 Q2063.51 216.849 2061.03 216.849 Q2054.82 216.849 2051.19 213.238 Q2047.58 209.627 2047.58 203.469 Q2047.58 197.104 2051.01 193.377 Q2054.45 189.627 2060.29 189.627 Q2065.52 189.627 2068.55 193.006 Q2071.61 196.363 2071.61 202.15 M2067.35 200.9 Q2067.3 197.405 2065.38 195.321 Q2063.48 193.238 2060.33 193.238 Q2056.77 193.238 2054.62 195.252 Q2052.49 197.266 2052.16 200.923 L2067.35 200.9 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2095.66 194.187 L2095.66 180.159 L2099.92 180.159 L2099.92 216.178 L2095.66 216.178 L2095.66 212.289 Q2094.32 214.603 2092.26 215.738 Q2090.22 216.849 2087.35 216.849 Q2082.65 216.849 2079.69 213.099 Q2076.75 209.349 2076.75 203.238 Q2076.75 197.127 2079.69 193.377 Q2082.65 189.627 2087.35 189.627 Q2090.22 189.627 2092.26 190.761 Q2094.32 191.872 2095.66 194.187 M2081.14 203.238 Q2081.14 207.937 2083.07 210.622 Q2085.01 213.284 2088.39 213.284 Q2091.77 213.284 2093.71 210.622 Q2095.66 207.937 2095.66 203.238 Q2095.66 198.539 2093.71 195.877 Q2091.77 193.192 2088.39 193.192 Q2085.01 193.192 2083.07 195.877 Q2081.14 198.539 2081.14 203.238 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2108.69 190.252 L2112.95 190.252 L2112.95 216.178 L2108.69 216.178 L2108.69 190.252 M2108.69 180.159 L2112.95 180.159 L2112.95 185.553 L2108.69 185.553 L2108.69 180.159 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2140.52 191.247 L2140.52 195.229 Q2138.71 194.233 2136.88 193.747 Q2135.08 193.238 2133.23 193.238 Q2129.08 193.238 2126.79 195.877 Q2124.5 198.492 2124.5 203.238 Q2124.5 207.983 2126.79 210.622 Q2129.08 213.238 2133.23 213.238 Q2135.08 213.238 2136.88 212.752 Q2138.71 212.242 2140.52 211.247 L2140.52 215.182 Q2138.74 216.016 2136.82 216.432 Q2134.92 216.849 2132.76 216.849 Q2126.91 216.849 2123.46 213.168 Q2120.01 209.488 2120.01 203.238 Q2120.01 196.895 2123.48 193.261 Q2126.98 189.627 2133.04 189.627 Q2135.01 189.627 2136.88 190.043 Q2138.76 190.437 2140.52 191.247 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2152.14 182.891 L2152.14 190.252 L2160.91 190.252 L2160.91 193.562 L2152.14 193.562 L2152.14 207.636 Q2152.14 210.807 2153 211.71 Q2153.88 212.613 2156.54 212.613 L2160.91 212.613 L2160.91 216.178 L2156.54 216.178 Q2151.61 216.178 2149.73 214.349 Q2147.86 212.497 2147.86 207.636 L2147.86 193.562 L2144.73 193.562 L2144.73 190.252 L2147.86 190.252 L2147.86 182.891 L2152.14 182.891 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2166.51 190.252 L2170.77 190.252 L2170.77 216.178 L2166.51 216.178 L2166.51 190.252 M2166.51 180.159 L2170.77 180.159 L2170.77 185.553 L2166.51 185.553 L2166.51 180.159 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2189.73 193.238 Q2186.31 193.238 2184.31 195.923 Q2182.32 198.585 2182.32 203.238 Q2182.32 207.891 2184.29 210.576 Q2186.28 213.238 2189.73 213.238 Q2193.13 213.238 2195.12 210.553 Q2197.12 207.867 2197.12 203.238 Q2197.12 198.631 2195.12 195.946 Q2193.13 193.238 2189.73 193.238 M2189.73 189.627 Q2195.29 189.627 2198.46 193.238 Q2201.63 196.849 2201.63 203.238 Q2201.63 209.604 2198.46 213.238 Q2195.29 216.849 2189.73 216.849 Q2184.15 216.849 2180.98 213.238 Q2177.83 209.604 2177.83 203.238 Q2177.83 196.849 2180.98 193.238 Q2184.15 189.627 2189.73 189.627 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2230.24 200.529 L2230.24 216.178 L2225.98 216.178 L2225.98 200.668 Q2225.98 196.988 2224.55 195.159 Q2223.11 193.33 2220.24 193.33 Q2216.79 193.33 2214.8 195.53 Q2212.81 197.729 2212.81 201.525 L2212.81 216.178 L2208.53 216.178 L2208.53 190.252 L2212.81 190.252 L2212.81 194.28 Q2214.34 191.942 2216.4 190.784 Q2218.48 189.627 2221.19 189.627 Q2225.66 189.627 2227.95 192.405 Q2230.24 195.159 2230.24 200.529 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>Now just as with the neural ODE we define a loss function that calculates the mean and variance from <code>n</code> runs at each time point and uses the distance from the data values:</p><pre><code class="language-julia hljs">function predict_neuralsde(p, u = u0)
  return Array(neuralsde(u, p))
end

function loss_neuralsde(p; n = 100)
  u = repeat(reshape(u0, :, 1), 1, n)
  samples = predict_neuralsde(p, u)
  means = mean(samples, dims = 2)
  vars = var(samples, dims = 2, mean = means)[:, 1, :]
  means = means[:, 1, :]
  loss = sum(abs2, sde_data - means) + sum(abs2, sde_data_vars - vars)
  return loss, means, vars
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">loss_neuralsde (generic function with 1 method)</code></pre><pre><code class="language-julia hljs">list_plots = []
iter = 0

# Callback function to observe training
callback = function (p, loss, means, vars; doplot = false)
  global list_plots, iter

  if iter == 0
    list_plots = []
  end
  iter += 1

  # loss against current data
  display(loss)

  # plot current prediction against data
  plt = Plots.scatter(tsteps, sde_data[1,:], yerror = sde_data_vars[1,:],
                     ylim = (-4.0, 8.0), label = &quot;data&quot;)
  Plots.scatter!(plt, tsteps, means[1,:], ribbon = vars[1,:], label = &quot;prediction&quot;)
  push!(list_plots, plt)

  if doplot
    display(plt)
  end
  return false
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">#4 (generic function with 1 method)</code></pre><p>Now we train using this loss function. We can pre-train a little bit using a smaller <code>n</code> and then decrease it after it has had some time to adjust towards the right mean behavior:</p><pre><code class="language-julia hljs">opt = ADAM(0.025)

# First round of training with n = 10
adtype = Optimization.AutoZygote()
optf = Optimization.OptimizationFunction((x,p) -&gt; loss_neuralsde(x, n=10), adtype)
optprob = Optimization.OptimizationProblem(optf, neuralsde.p)
result1 = Optimization.solve(optprob, opt,
                                 callback = callback, maxiters = 100)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">u: 258-element Vector{Float32}:
 -0.14584991
 -0.075341836
 -0.039118804
 -0.4484497
 -0.15411483
  0.4389499
 -0.07190875
  0.25046995
  0.42017728
 -0.15930374
  ⋮
 -0.32937312
 -0.37748304
  0.12519081
  0.41300792
 -0.3665566
 -0.95612776
  0.99297607
 -0.50361264
  0.22149095</code></pre><p>We resume the training with a larger <code>n</code>. (WARNING - this step is a couple of orders of magnitude longer than the previous one).</p><pre><code class="language-julia hljs">optf2 = Optimization.OptimizationFunction((x,p) -&gt; loss_neuralsde(x, n=100), adtype)
optprob2 = Optimization.OptimizationProblem(optf2, result1.u)
result2 = Optimization.solve(optprob2, opt,
                                 callback = callback, maxiters = 100)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">u: 258-element Vector{Float32}:
 -0.07538656
 -0.2286176
 -0.12526992
 -0.38909972
 -0.08401
  0.50766265
 -0.02292966
  0.29956153
  0.3761513
 -0.07924019
  ⋮
 -0.50801516
 -0.022233937
 -0.030337207
  0.54097027
 -0.33356002
 -0.9666683
  0.73752934
 -0.7034842
  0.057694692</code></pre><p>And now we plot the solution to an ensemble of the trained neural SDE:</p><pre><code class="language-julia hljs">_, means, vars = loss_neuralsde(result2.u, n = 1000)

plt2 = Plots.scatter(tsteps, sde_data&#39;, yerror = sde_data_vars&#39;,
                     label = &quot;data&quot;, title = &quot;Neural SDE: After Training&quot;,
                     xlabel = &quot;Time&quot;)
plot!(plt2, tsteps, means&#39;, lw = 8, ribbon = vars&#39;, label = &quot;prediction&quot;)

plt = plot(plt1, plt2, layout = (2, 1))
savefig(plt, &quot;NN_sde_combined.png&quot;); nothing # sde</code></pre><p><img src="https://user-images.githubusercontent.com/1814174/76975872-88dc9100-6909-11ea-80f7-242f661ebad1.png" alt/></p><p>Try this with GPUs as well!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../augmented_neural_ode/">« Augmented Neural Ordinary Differential Equations</a><a class="docs-footer-nextpage" href="../collocation/">Smoothed Collocation for Fast Two-Stage Training »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Wednesday 27 July 2022 03:59">Wednesday 27 July 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
